(function(){"use strict";jQuery(document).ready(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(y=null!=(q=window.wc_memberships_admin)?q:{},w=null!=(r=window.typenow)?r:"",m=null!=(s=window.pagenow)?s:"",i=function(){var a;return a={formatMatches:function(a){return 1===a?wc_enhanced_select_params.i18n_matches_1:wc_enhanced_select_params.i18n_matches_n.replace("%qty%",a)},formatNoMatches:function(){return wc_enhanced_select_params.i18n_no_matches},formatAjaxError:function(a,b,c){return wc_enhanced_select_params.i18n_ajax_error},formatInputTooShort:function(a,b){var c;return c=b-a.length,1===c?wc_enhanced_select_params.i18n_input_too_short_1:wc_enhanced_select_params.i18n_input_too_short_n.replace("%qty%",c)},formatInputTooLong:function(a,b){var c;return c=a.length-b,1===c?wc_enhanced_select_params.i18n_input_too_long_1:wc_enhanced_select_params.i18n_input_too_long_n.replace("%qty%",c)},formatSelectionTooBig:function(a){return 1===a?wc_enhanced_select_params.i18n_selection_too_long_1:wc_enhanced_select_params.i18n_selection_too_long_n.replace("%qty%",a)},formatLoadMore:function(a){return wc_enhanced_select_params.i18n_load_more},formatSearching:function(){return wc_enhanced_select_params.i18n_searching}}},y.initializeEnhancedSelect=function(b,c){var d;return a(b).is(".enhanced")&&a(b).removeClass("enhanced"),d={allowClear:!!a(b).data("allow_clear"),placeholder:a(b).data("placeholder"),minimumInputLength:a(b).data("minimum_input_length")?a(b).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:y.ajax_url,dataType:"json",quietMillis:250,data:function(b,d){return a.extend({term:b},c)},results:function(b,c){var d;return d=[],b&&a.each(b,function(a,b){return d.push({id:a,text:b})}),{results:d}},cache:!0}},a(b).data("multiple")===!0?(d.multiple=!0,d.initSelection=function(b,c){var d,e;return d=a.parseJSON(b.attr("data-selected")),e=[],a(b.val().split(",")).each(function(a,b){return e.push({id:b,text:d[b]})}),c(e)},d.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(d.multiple=!1,d.initSelection=function(a,b){var c;return c={id:a.val(),text:a.attr("data-selected")},b(c)}),d=a.extend(d,i()),a(b).select2(d).addClass("enhanced")},o=function(a){var b;return b={type:a.split("|")[0],name:a.split("|")[1]}},h=function(a){var b;switch(b={},a.type){case"taxonomy":b.action="wc_memberships_json_search_terms",b.security=y.search_terms_nonce,b.taxonomy=a.name;break;case"post_type":b.action="product"===a.name?"woocommerce_json_search_products_and_variations":"wc_memberships_json_search_posts",b.security="product"===a.name?y.search_products_nonce:y.search_posts_nonce,b.post_type=a.name}return b},p=function(b){var c;return c=0,a("table."+b+"-rules tbody."+b+"-rule").each(function(d,e){if(!a(e).hasClass(b+"-rule-__INDEX__"))return a(e).removeClass(function(a,c){var d,e;if(e=new RegExp(b+"-rule-[0-9]","g"),d=c.match(e))return d[0]}),a(e).addClass(b+"-rule-"+c),a("input, select, textarea",e).each(function(a,b){var d;if(d=jQuery(b),d.attr("name"))return d.attr("name",d.attr("name").replace(/\[([^[]*)\]/,"["+c+"]"))}),c++})},v=function(b){var c,d,e,f;if(e=a(b).get(0).tagName,f="INPUT"===e?a('input[type="radio"][name="'+a(b).attr("name")+'"]:checked').val():a(b).val(),c=a(b).closest(".rule"),"immediate"===f){if(c.find(".js-show-if-access-schedule-immediate").removeClass("hide"),c.find(".js-hide-if-access-schedule-immediate").addClass("hide"),"SELECT"===e)return c.find(".js-access-schedule-period-selector").val(f).first().focus()}else if(c.find(".js-show-if-access-schedule-immediate").addClass("hide"),c.find(".js-hide-if-access-schedule-immediate").removeClass("hide"),"SELECT"!==e||a(b).hasClass("access_schedule-period")||c.find(".access_schedule-period").find("option").removeAttr("selected"),d=c.find(".access_schedule-amount"),d.val()||d.val(1),a(b).hasClass("js-schedule-type"))return d.focus()},j=function(b){var c,d,e;return e="."+b+"-rules",d="input.js-object-ids",c=a(e),c.on("change",".js-content-type",function(b){var c,e;return e=h(o(a(this).val())),c=a(this).closest("tr").find(d),a(c).removeData("selected").val("").select2("destroy"),y.initializeEnhancedSelect(c,e)}),c.on("change",".js-access-schedule-period-selector",function(a){return v(this)}),c.find(d).each(function(){var c,d;if(!a(this).closest("tbody").hasClass(b+"-rule-__INDEX__"))return d=a(this).closest("tbody").find(".js-content-type").get(0).value,c=h(o(d)),y.initializeEnhancedSelect(this,c)}),c.find(".js-add-rule").click(function(){var e,f,g,i,j;return f=c.find("."+b+"-rule-__INDEX__"),i=c.children("tbody").length-1,e=a(f.prop("outerHTML").replace(/__INDEX__/g,i)),f.before(e),e.find(".js-content-type").length&&(g=e.find(".js-content-type").get(0).value,j=h(o(g)),y.initializeEnhancedSelect(e.find(d),j)),c.find(".norules").addClass("hide"),c.find("tfoot .js-remove-rules").removeClass("hide"),p(b)}),c.find(".js-remove-rules").click(function(){var d;return d=c.find('td.check-column input[type="checkbox"]:checked'),a.when(d.closest("tbody").fadeOut(400,function(){var b;return b=a(this),b.find(".js-rule-id").val()?b.addClass("hide").find(".js-rule-remove").val(1):setTimeout(function(){return b.remove()},1)})).then(function(){return c.find(".rule:visible").length<1&&(c.find(".norules").removeClass("hide"),c.find(".js-remove-rules").addClass("hide")),c.find('th.check-column input[type="checkbox"]').removeAttr("checked"),p(b)})})},t=function(b,c){var d,e,f,g,h;if(g=b,"add_member"===c)f=a('<form method="get" action="'+y.new_user_membership_url+'"> <input type="hidden" name="post_type" value="wc_user_membership" /> <h3 class="wc-memberships-select-user">'+y.i18n.select_user+"</h3> </form>");else{if("transfer_membership"!==c)return;f=a('<div> <input type="hidden" name="post_type" value="wc_user_membership" /> <h3 class="wc-memberships-select-user">'+y.i18n.select_user+"</h3> </div>")}return f.append('<p><input type="hidden" class="wc-customer-search" name="user" id="search_member_id" data-placeholder="'+y.i18n.search_for_user+'" data-allow_clear="true" /></p>'),d=a('<div class="wp-pointer-buttons" />'),e=a('<a class="close wc-memberships-search-member-pointer-close" href="#">'+y.i18n.cancel+"</a>"),h=a('<button class="button button-primary">'+y.i18n[c]+"</button>"),e.on("click.pointer",function(a){return a.preventDefault(),g.pointer("close")}),"transfer_membership"===c&&h.on("click",function(b){var c,d;if(b.preventDefault,d=a("#search_member_id").val())return c={action:"wc_memberships_transfer_user_membership",security:y.transfer_user_membership_nonce,prev_user:g.data("user-id"),new_user:d,membership:g.data("membership-id")},a.post(y.ajax_url,c,function(a){return console.log(a),location.reload()})}),f.find("#search_member_id").on("change",function(b){return a(this).val()?h.removeAttr("disabled"):h.attr("disabled","disabled")}),f.find("#search_member_id").val()?h.removeAttr("disabled"):h.attr("disabled","disabled"),d.append(e).append(h),f.append(d),f},u=function(b){return a(document.body).trigger("wc-enhanced-select-init")},"woocommerce_page_wc-settings"===m&&(a("#wc_memberships_restriction_mode").change(function(b){return"redirect"===a(this).val()?a("#wc_memberships_redirect_page_id").closest("tr").show():a("#wc_memberships_redirect_page_id").closest("tr").hide(),"hide"===a(this).val()?a("#wc_memberships_show_excerpts").closest("tr").hide():a("#wc_memberships_show_excerpts").closest("tr").show()}).change(),a("#wc_memberships_display_member_login_notice").change(function(b){return"never"===a(this).val()?a("#wc_memberships_member_login_message").closest("tr").hide():a("#wc_memberships_member_login_message").closest("tr").show()}).change()),"edit-wc_user_membership"!==m&&"wc_user_membership"!==m||(a(".page-title-action, .add-new-h2").pointer({pointerClass:"create-membership-pointer",position:"top",content:function(b){return t(a(this),"add_member")},buttons:function(a){return""}}).on("click",function(b){return b.preventDefault(),a(this).pointer("toggle")}).on("pointeropened",function(a){return u("search_member_id")}),a(".transfer_user_membership").pointer({pointerClass:"transfer-membership-pointer",position:"top",content:function(b){return t(a(this),"transfer_membership")},buttons:function(a){return""}}).on("click",function(b){return b.preventDefault(),a(this).pointer("toggle")}).on("pointeropened",function(a){return u("search_member_id")}),a(".delete-membership").on("click",function(a){return confirm(y.i18n.delete_membership_confirm)}),a("input.action").on("click",function(b){var c,d;return b.preventDefault(),c=a(this).parent("div"),d=c.find("select"),"delete"!==d.val()?"export"!==d.val()||a("#posts-filter").submit():confirm(y.i18n.delete_memberships_confirm)?a("#posts-filter").submit():void 0}),a(".delete-membership-and-subscription").on("click",function(b){var c;if(b.preventDefault(),confirm(y.i18n.delete_membership_confirm))return c={action:"wc_memberships_delete_membership_and_subscription",security:y.delete_user_membership_subscription_nonce,user_membership_id:a(this).data("user-membership-id"),subscription_id:a(this).data("subscription-id")},a.post(y.ajax_url,c,function(a){return console.log(a),window.location.href=y.user_membership_url})})),"wc_user_membership"===m&&(f=a(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:y.calendar_image,buttonImageOnly:!0,onSelect:function(b){var c,d,e;return e=a(this).is("#_start_date")?"minDate":"maxDate",d=a(this).data("datepicker"),c=a.datepicker.parseDate(d.settings.dateFormat||a.datepicker._defaults.dateFormat,b,d.settings),f.not(this).datepicker("option",e,c)}}),l={opacity:.6},a("#wc-memberships-user-membership-data").on("click","a.js-calc-plan-date",function(b){var c,d,e,f,g,h;return b.preventDefault(),a(this).hasClass("js-calc-plan-start-date")?(h="start",f="wc_memberships_get_membership_plan_start_date"):(h="end",f="wc_memberships_get_membership_plan_end_date"),d=a("#post_parent"),e=a("#_start_date"),c=a("#_end_date"),g={action:f,security:y.get_membership_date_nonce,plan:d.val(),start_date:e.val()},a.post(y.ajax_url,g,function(a){if(a)return"start"===h?e.val(a.data.substring(0,10)):c.val(a.data.substring(0,10))})}),a("#post_parent").on("change",function(b){var c,d,e,f,g;if(f=a(this).val())return d=a("#_start_date"),c=a("#_end_date"),g={action:"wc_memberships_get_membership_plan_start_date",security:y.get_membership_date_nonce,plan:f,start_date:d.val()},a.post(y.ajax_url,g,function(a){if(a)return d.val(a.data.substring(0,10))}),e={action:"wc_memberships_get_membership_plan_end_date",security:y.get_membership_date_nonce,plan:f,start_date:d.val()},a.post(y.ajax_url,e,function(a){if(a)return c.val(a.data.substring(0,10))})}),a(".post_status_field").on("change","select#post_status",function(b){var c;if("wcm-expired"===a(this).val())return c=a("#_end_date"),c.datepicker(),c.datepicker("setDate",new Date)}),a("#wc-memberships-user-membership-notes").on("click","a.js-add-note",function(b){var c,d;if(b.preventDefault(),d=a("textarea#user-membership-note").val())return a("#wc-memberships-user-membership-notes").block({message:null,overlayCSS:l}),c={action:"wc_memberships_add_user_membership_note",post_id:a("#post_ID").val(),note:d,notify:a("#note-notify").is(":checked"),security:y.add_user_membership_note_nonce},a.post(y.ajax_url,c,function(b){var c;return c=a(b),a("ul.wc-user-membership-notes").prepend(c.find("#notes").html()),a("ul.wc-user-membership-recent-activity").prepend(c.find("#recent-activity").html()),a("#wc-memberships-user-membership-notes").unblock(),a("textarea#user-membership-note").val(""),a("#note-notify").prop("checked",!1)})}).on("click","a.js-delete-note",function(b){var c,d;return b.preventDefault(),d=a(this).closest("li.note"),a(d).block({message:null,overlayCSS:l}),c={action:"wc_memberships_delete_user_membership_note",note_id:a(d).attr("rel"),security:y.delete_user_membership_note_nonce},a.post(y.ajax_url,c,function(b){return a(d).remove()})})),"wc_membership_plan"===m&&(a.each(["content-restriction","product-restriction","purchasing-discount"],function(a,b){return j(b)}),y.initializeEnhancedSelect(a(".js-ajax-select-products"),{action:"woocommerce_json_search_products_and_variations",security:y.search_products_nonce,screen:"wc_membership_plan"}),a(".js-access-method-selector").on("change",function(b){var c,d,e,f,g;return g=a(".js-access-method-selector:checked",".plan-access-method-field").val(),e=a(this).closest(".options_group"),d=e.find(".js-show-if-access-method-purchase"),c=a(".misc-pub-grant-access"),f=a("#wp-WC_Memberships_User_Membership_Renewal_Reminder_Email-wrap").parent(".options_group"),"purchase"===g?(d.removeClass("hide"),c.show(),f.show()):(d.addClass("hide"),c.hide(),f.hide())}).change(),a(".plan-access-length-field").on("change",".js-access-length-type-selector",function(b){var c,d,e,f,g;if(g=a(".js-access-length-type-selector:checked",".plan-access-length-field").val(),d=a(this).closest(".form-field"),f=d.find(".js-show-if-access-length-type-specific"),e=d.find(".js-show-if-access-length-type-fixed"),"specific"===g?(f.removeClass("hide"),e.addClass("hide")):"fixed"===g?(f.addClass("hide"),e.removeClass("hide")):(f.addClass("hide"),e.addClass("hide")),c=d.find(".access_length-amount"),c.val()||c.val(1),a(this).hasClass("js-access-length-type"))return c.focus()}),a(".js-plan-access-set-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:y.calendar_image,buttonImageOnly:!0}),a("ul.wc-tabs").show(),a("div.panel-wrap").each(function(){return a(this).find("div.panel:not(:first)").hide()}),a("ul.wc-tabs a").click(function(){var b,c,d;switch(d=a(this).attr("href"),c=a(this).closest("div.panel-wrap"),b=a("#wc-memberships-membership-plan-email-content-merge-tags"),a("ul.wc-tabs li",c).removeClass("active"),a(this).parent().addClass("active"),a("div.panel",c).hide(),a(d).show(),"#membership-plan-email-content"===a(this).attr("href")?b.show():b.hide(),a(".js-memberships-restrict-notice").hide(),d){case"#membership-plan-data-restrict-content":a(".js-memberships-restrict-content-notice").show();break;case"#membership-plan-data-restrict-products":a(".js-memberships-restrict-products-notice").show()}return!1}),a("ul.wc-tabs li:visible").eq(0).find("a").click()),w&&y.restrictable_post_types.indexOf(w)>-1&&(a.each(["content-restriction","product-restriction","purchasing-discount"],function(a,b){return j(b)}),a(".wc-memberships .js-toggle-rules").on("click",function(){return a(this).closest("p.form-field").next(".js-restrictions").toggleClass("hide")}),a(".wc-memberships .js-toggle-discounts").on("click",function(){return a(this).closest("p.form-field").next(".js-discounts").toggleClass("hide")}),a(".wc-memberships .js-toggle-custom-message").on("click",function(){return a(this).closest("p.form-field").next(".js-custom-message-editor-container").toggleClass("hide")}),"product"===m&&(b=a(".js-membership-plan-ids"),n={action:"wc_memberships_json_search_posts",security:y.search_posts_nonce,post_type:"wc_membership_plan"},k="initializeEnhancedSelect",y[k](b,n),a(document.body).on("woocommerce-product-type-change",function(b,c){return k=c.indexOf("variable")!==-1?"removeClass":"addClass",a(".wc-memberships .variable-notice")[k]("hide"),k="grouped"===c?"removeClass":"addClass",a(".wc-memberships .grouped-notice")[k]("hide"),k="grouped"===c?"addClass":"removeClass",a(".wc-memberships .wc-memberships-data")[k]("hide")}))),"admin_page_wc_memberships_import_export"===m)return f=a(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:y.calendar_image,buttonImageOnly:!0}),d=a("#wc_memberships_members_csv_import_create_new_user_memberships"),x=a("#wc_memberships_members_csv_import_merge_existing_user_memberships"),c=a("#wc_memberships_members_csv_import_allow_memberships_transfer").closest("fieldset"),e=a("#wc_memberships_members_csv_import_create_new_users").closest("fieldset"),g=a("#wc_memberships_members_csv_import_default_start_date").closest("tr"),d.on("change",function(a){return d.is(":checked")?(g.show(),e.show()):(g.hide(),e.hide())}).trigger("change"),x.on("change",function(a){return x.is(":checked")?c.show():c.hide()}).trigger("change")})}).call(this);