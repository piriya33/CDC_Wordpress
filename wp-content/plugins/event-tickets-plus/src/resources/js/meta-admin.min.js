var tribe_event_tickets_plus=tribe_event_tickets_plus||{};tribe_event_tickets_plus.meta=tribe_event_tickets_plus.meta||{},tribe_event_tickets_plus.meta.admin=tribe_event_tickets_plus.meta.admin||{},tribe_event_tickets_plus.meta.admin.event=tribe_event_tickets_plus.meta.admin.event||{},function(e,t,i,n){"use strict";n.init=function(){n.$tribe_tickets=i(t.getElementById("tribetickets")),n.$event_tickets=i(t.getElementById("event_tickets")),n.$event_tickets.on("change","input.show_attendee_info",n.event.toggle_linked_form).on("change",".save_attendee_fieldset",n.event.toggle_linked_form),n.$tribe_tickets.on("change",".ticket-attendee-info-dropdown",n.event.select_saved_fieldset).on("change",".save_attendee_fieldset",n.event.toggle_linked_form).on("click",".meta-postbox .hndle, .meta-postbox .handlediv",n.event.click_postbox).on("click","a.add-attendee-field",n.event.add_field).on("click","a.delete-attendee-field",n.event.remove_field).on("edit-ticket.tribe",n.event.edit_ticket).on("saved-ticket.tribe",n.event.saved_ticket),n.init_ticket_fields(),n.$event_tickets.trigger("event-tickets-plus-meta-initialized.tribe")},n.init_ticket_fields=function(){n.$event_tickets||(n.$event_tickets=i(t.getElementById("event_tickets"))),n.init_custom_field_sorting(),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-ticket-meta-initialized.tribe",{ticket_id:n.$event_tickets.find("#ticket_id").val()})},n.init_custom_field_sorting=function(){i(t.getElementById("tribe-tickets-attendee-sortables")).sortable({containment:"parent",items:"> div",tolerance:"pointer",connectWith:"#tribe-tickets-attendee-sortables"})},n.toggle_linked_form=function(e){var n=i(),s=e.data("tribe-toggle");s&&(n=i(t.getElementById(s))),e.is(":checked")?n.show():n.hide()},n.maybe_hide_saved_fields_select=function(){i(".tribe-tickets-attendee-info-active-field").length?i(".tribe-tickets-attendee-saved-fields").hide():i(".tribe-tickets-attendee-saved-fields").show()},n.fetch_saved_fields=function(e){var t={action:"tribe-tickets-load-saved-fields",fieldset:e};return i.post(ajaxurl,t,"json")},n.inject_saved_fields=function(e){var s=n.fetch_saved_fields(e);s.done(function(s){s.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(s.data),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-fieldset-loaded.tribe",{fieldset_id:e})):n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})}),s.fail(function(){n.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})})},n.add_field=function(e){var s={action:"tribe-tickets-info-render-field",type:e},d=i.post(ajaxurl,s,"json");d.done(function(s){s.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(s.data),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-field-added.tribe",{type:e})):n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})}),d.fail(function(){n.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})})},n.remove_field=function(e){var t="";t="undefined"!==e[0].outerHTML?e[0].outerHTML:i("<div>").append(e.eq(0).clone()).html(),e.remove(),n.maybe_hide_saved_fields_select(),n.$event_tickets.trigger("event-tickets-plus-field-removed.tribe",{field:t})},n.toggle_postbox=function(e){e.toggleClass("closed")},n.event.toggle_linked_form=function(){n.toggle_linked_form(i(this))},n.event.select_saved_fieldset=function(){var e=i(this).val();e&&0!==parseInt(e,10)&&n.inject_saved_fields(e)},n.event.add_field=function(e){e.preventDefault(),n.add_field(i(this).data("type"))},n.event.remove_field=function(e){e.preventDefault(),n.remove_field(i(this).closest(".meta-postbox"))},n.event.edit_ticket=function(){n.init_ticket_fields()},n.event.click_postbox=function(){n.toggle_postbox(i(this).closest(".meta-postbox"))},n.event.saved_ticket=function(e,n){if(void 0!==n.fieldsets&&n.success){var s=i(t.getElementById("saved_ticket-attendee-info"));s.find('option:not([value="0"])').remove();for(var d=0;d<n.fieldsets.length;d++)s.append('<option value="'+n.fieldsets[d].ID+'" data-attendee-group="'+n.fieldsets[d].post_name.replace('"','\\"')+'">'+n.fieldsets[d].post_name+"</option>")}},i(function(){n.init()})}(window,document,jQuery,tribe_event_tickets_plus.meta.admin);