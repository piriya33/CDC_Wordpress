!function(a,b){'use strict';function c(a){function b(a){return('0'+parseInt(a,10).toString(16)).slice(-2)}return/^#[0-9A-F]{6}$/i.test(a)?a:'rgba(0, 0, 0, 0)'===a||'transparent'===a?'':(a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),'#'+b(a[1])+b(a[2])+b(a[3]))}function d(a){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)}if(a&&a.customize){var e=a.customize;e.SPDesigner=e.SPDesigner||{},e.SPDesigner.data={phpIntMax:0,section:'',fontVariants:{}},'undefined'!=typeof _wpCustomizeSPDesignerSettings&&b.extend(e.SPDesigner.data,_wpCustomizeSPDesignerSettings),e.SPDesigner.generateRandomSelectorId=function(){return Math.ceil(e.SPDesigner.data.phpIntMax*Math.random())},e.SPDesigner.measurementPicker={_create:function(){var a=this,c=a.element;a.close=b.proxy(a.close,a),this.valueInput=c.find('.sp-measurement-value'),this.unitSelect=c.find('.sp-measurement-unit'),this.valueInput&&this.unitSelect&&(this.valueInput.next('.sp-measurement-unit').addBack().wrapAll('<div class="sp-measurement-picker" />'),a.wrap=this.valueInput.parent().hide().wrap(b('<div class="sp-measurement-container" />')),a.container=a.wrap.parent(),a.toggler=b('<a tabindex="0" class="button sp-measurement-result" />').prependTo(a.container),a.updateToggler(),a._addListeners())},_addListeners:function(){var a=this;a.container.on('click.measurementpicker',function(a){a.stopPropagation()}),a.toggler.click(function(){a.toggler.hasClass('sp-measurement-picker-open')?a.close():a.open()}),a.valueInput.change(function(){a.updateToggler()}),a.unitSelect.change(function(){a.updateToggler()})},open:function(){this.wrap.show(),this.toggler.hide(),this.wrap.addClass('sp-measurement-picker-active'),this.toggler.addClass('sp-measurement-picker-open'),b('body').trigger('click.measurementpicker').on('click.measurementpicker',this.close)},close:function(){this.wrap.hide(),this.toggler.show(),this.wrap.removeClass('sp-measurement-picker-active'),this.toggler.removeClass('sp-measurement-picker-open'),b('body').off('click.measurementpicker',this.close)},updateToggler:function(){this.toggler.text(this.valueInput.val().toString()+this.unitSelect.val().toString())}},b.widget('sp.spMeasurementPicker',e.SPDesigner.measurementPicker),e.SPDesigner.CSSControl=e.Control.extend({ready:function(){var a=this;a.active.validate=function(){var b=e.section(a.section());return!!b&&b.active()},this._setupUpdateUI(),this._setupUI()},focus:function(){e.each(function(a,b){b.match(/^sp_designer_css_data\[(.+?)]/)&&!_.isUndefined(e.control(b))&&e.control(b).close()}),this.open()},open:function(){this.container.closest('.accordion-section-content').addClass('sp-designer-control-settings-visible'),this.container.find('.sp-designer-selector-content').addClass('sp-designer-selector-content-visible'),b(this.container.closest('.accordion-section-content')).hasClass('customize-pane-child')||(this._resizeContentHeight(),b(window).on('resize.customizer-section',_.debounce(_.bind(this._resizeContentHeight,this),200)))},close:function(){this.container.closest('.sp-designer-control-settings-visible').removeClass('sp-designer-control-settings-visible'),this.container.find('.sp-designer-selector-content-visible').removeClass('sp-designer-selector-content-visible')},_setupUI:function(){var c,d,f,g=this;c=a.template('sp-designer-selector-title'),d={action:e.section(this.section()).params.customizeAction,title:e.section(this.section()).params.title},f=g.container,f.closest('.accordion-section-content').addClass('sp-accordion-section-content'),f.find('.sp-designer-selector-content').prepend(c(d)),f.find('.sp-designer-selector-title').on('click',function(a){a.preventDefault(),g.open()}),f.find('.customize-section-back').on('click',function(a){a.preventDefault(),g.close()}),f.find('button.item-delete').on('click',function(a){a.preventDefault(),g.setting.set(!1)}),f.find('[data-sp-designer-property="fontFamily"]').selectize({onChange:function(a){var b,c=_.findWhere(e.SPDesigner.data.fontVariants,{family:a}),d=f.find('[data-sp-designer-property="fontVariant"]')[0].selectize;b=g._getFontVariantOptions(c),d.clearOptions(),d.addOption(b),_.findWhere(b,{id:'regular'})?d.setValue('regular'):d.setValue(b[0].id),d.refreshOptions(!1),1>=b.length?d.disable():d.enable()},onDropdownClose:function(){''===this.getValue()&&this.setValue('Default')}}),f.find('[data-sp-designer-property="fontVariant"]').selectize({valueField:'id',labelField:'text',searchField:'text',onInitialize:function(){var a,b,c,d;a=f.find('[data-sp-designer-property="fontFamily"]')[0].selectize,b=_.findWhere(e.SPDesigner.data.fontVariants,{family:a.getValue()}),c=g._getFontVariantOptions(b),this.clearOptions(),this.addOption(c),d=_.noop(),g.elements.fontVariant&&!_.isUndefined(g.elements.fontVariant.get())&&(d=g.elements.fontVariant.get()),d?this.setValue(g.elements.fontVariant.get()):this.setValue('regular'),this.refreshOptions(!1),1>=c.length?this.disable():this.enable()},onDropdownClose:function(){''===this.getValue()&&this.setValue('regular')}}),f.find('.sp-designer-color input[type=text]').wpColorPicker({change:function(){var a=b(this).data('sp-designer-property');g.elements[a]&&g.elements[a].set(b(this).wpColorPicker('color'))},clear:function(){var a=b(this).data('sp-designer-property');g.elements[a]&&g.elements[a].set('')}}),f.find('.sp-designer-measurement').spMeasurementPicker(),g.bgImage={},g.bgImage.container=f.find('.sp-designer-background-image'),g.bgImage.placeholder=b(g.bgImage.container).find('.placeholder'),g.bgImage.img=b(g.bgImage.container).find('img'),g.bgImage.btnAdd=b(g.bgImage.container).find('.new'),g.bgImage.btnChange=b(g.bgImage.container).find('.change'),g.bgImage.btnRemove=b(g.bgImage.container).find('.remove'),g.bgImage.bgRepeat=f.find('.sp-designer-background-repeat'),g.bgImage.bgPosition=f.find('.sp-designer-background-position'),g.bgImage.bgAttachment=f.find('.sp-designer-background-attachment'),_.bindAll(g,'_bgImageRemoveImg','_bgImageUpload','_bgImageRender','_bgImageUpdate','_bgImagePick'),g.bgImage.btnAdd.on('click',this._bgImageUpload),g.bgImage.btnChange.on('click',this._bgImageUpload),g.bgImage.btnRemove.on('click',this._bgImageRemoveImg),this._bgImageRender()},_setupUpdateUI:function(){var a,b=this,c=b.setting();a=['fontStyle','textUnderline','textLineThrough','fontFamily','fontVariant','fontSize','fontSizeUnit','fontWeight','lineHeight','letterSpacing','letterSpacingUnit','letterSpacingUnit','color','marginTop','marginTopUnit','marginBottom','marginBottomUnit','marginLeft','marginLeftUnit','marginRight','marginRightUnit','paddingTop','paddingTopUnit','paddingBottom','paddingBottomUnit','paddingLeft','paddingLeftUnit','paddingRight','paddingRightUnit','borderRadius','borderRadiusUnit','borderColor','borderStyle','borderWidth','borderWidthUnit','backgroundColor','backgroundRepeat','backgroundPosition','backgroundAttachment'],b.elements={},_.each(a,function(a){b.elements[a]=new e.Element(b.container.find('[data-sp-designer-property="'+a+'"]'))}),_.each(b.elements,function(a,d){a.bind(function(c){a.element.is('input[type=checkbox]')&&(c=c?a.element.val():'');var e=b.setting();e&&e[d]!==c&&(e=_.clone(e),e[d]=c,b.setting.set(e))}),c&&a.set(c[d])}),b.setting.bind(function(a){!1===a?(b.close(),b.container.remove(),e.control.remove(b.id),e.previewer.refresh()):_.each(a,function(c,d){b.elements[d]&&b.elements[d].set(a[d])})})},_getFontVariantOptions:function(a){var b=[];return _.isUndefined(a)||_.isUndefined(a.variants)?b.push({id:'regular',text:'Regular'}):b=a.variants,b},_bgImageUpload:function(a){a.preventDefault(),this.bgImage.frame||this._bgImageInitFrame(),this.bgImage.frame.open()},_bgImageInitFrame:function(){this.bgImage.frame=a.media({title:e.SPDesigner.data.bgImage.l10n.choose,library:{type:e.SPDesigner.data.bgImage.mime_type},button:{text:e.SPDesigner.data.bgImage.l10n.set},multiple:!1}),this.bgImage.frame.on('select',this._bgImagePick)},_bgImagePick:function(){var a=this.bgImage.frame.state().get('selection').single();if('image'===a.get('type')){var b=this._bgImageReduceMembers(a.toJSON());this._bgImageUpdate(b)}},_bgImageReduceMembers:function(a){var c=['id','sizes','url'],d={};return b.each(c,function(b,c){d[c]=a[c]}),d},_bgImageRemoveImg:function(a){a.preventDefault(),this._bgImageUpdate({url:'',id:0})},_bgImageUpdate:function(a){var b=this,c=b.setting(),d='backgroundImage';c&&c[d]!==a&&(c=_.clone(c),c[d]=a,b.setting.set(c),this._bgImageRender())},_bgImageRender:function(){var a=this.setting();a&&a.backgroundImage&&a.backgroundImage.url?(this.bgImage.placeholder.hide(),a.backgroundImage.sizes&&a.backgroundImage.sizes.medium?this.bgImage.img.attr('src',a.backgroundImage.sizes.medium.url):this.bgImage.img.attr('src',a.backgroundImage.url),this.bgImage.img.show(),this.bgImage.btnRemove.show(),this.bgImage.btnChange.show(),this.bgImage.btnAdd.hide(),this.bgImage.bgRepeat.show(),this.bgImage.bgPosition.show(),this.bgImage.bgAttachment.show()):(this.bgImage.img.hide(),this.bgImage.placeholder.show(),this.bgImage.btnRemove.hide(),this.bgImage.btnChange.hide(),this.bgImage.btnAdd.show(),this.bgImage.bgRepeat.hide(),this.bgImage.bgPosition.hide(),this.bgImage.bgAttachment.hide())},_resizeContentHeight:function(){this.container.find('.sp-designer-selector-content').css('height',this.container.closest('.accordion-section-content').height())}}),e.SPDesignerCustomizer={pointClickStatus:!1,init:function(){var a=this;e.previewer.bind('sp-designer-click-selector',b.proxy(a.maybeBuildControl,this)),this.pointClickToggle()},pointClickToggle:function(){var a=this;b('.sp-designer-point-click-toggle').on('click',function(c){c.preventDefault(),!1===a.pointClickStatus?a.pointClickStatus=!0:a.pointClickStatus=!1,b(this).closest('#customize-theme-controls').toggleClass('sp-add-a-style-active',a.pointClickStatus),e.previewer.send('sp-designer-point-click',a.pointClickStatus)})},maybeBuildControl:function(a){var c,d,f,g,h,i=_.noop();e.each(function(b,c){if(c.match(/^sp_designer_css_data\[(.+?)]/)&&!_.isUndefined(e.control(c))){var d=e.control(c),f=d.setting();if(d&&a.selector===f.selector)return void(i=d)}}),_.isUndefined(i)&&(c=e.SPDesigner.generateRandomSelectorId(),d='sp_designer_css_data['+c+']',f={type:'sp_designer_css_data',transport:'postMessage',previewer:e.previewer},g=this._handleDefaults(a.cssProperties),g.selector=a.selector,e.create(d,d,g,f),h=_.findWhere(e.SPDesigner.data.selectorsMap,{selector:a.selector}),h=_.isUndefined(h)?a.selector:h.name,i=new e.controlConstructor.sp_designer_css(d,{params:{type:'sp_designer_css',content:'<li id="customize-control-'+String(c)+'" class="customize-control customize-control-sp_designer_css"></li>',label:h,section:e.SPDesigner.data.section,priority:this._calculatePriority(),active:!0,settings:{default:d},id:c,css:g},previewer:e.previewer}),e.control.add(d,i)),this.pointClickStatus=!1,b('#customize-theme-controls').toggleClass('sp-add-a-style-active',!1),e.previewer.send('sp-designer-point-click',!1),i.focus()},_calculatePriority:function(){var a=10;return e.control.each(function(b){'sp_designer_css'===b.params.type&&b.setting()&&(a=Math.max(a,b.priority()))}),a+=1},_handleDefaults:function(a){var b={fontSize:a.fontSize&&0<=parseInt(a.fontSize,10)?parseInt(a.fontSize,10):0,fontSizeUnit:a.fontSizeUnit?a.fontSizeUnit:'px',letterSpacing:a.letterSpacing?parseInt(a.letterSpacing,10):0,letterSpacingUnit:a.letterSpacingUnit?a.letterSpacingUnit:'px',lineHeight:a.lineHeight&&0<=parseInt(a.lineHeight,10)?parseInt(a.lineHeight,10):0,fontFamily:a.fontFamily?a.fontFamily:'Default',fontStyle:'italic'===a.fontStyle?a.fontStyle:'',color:a.color&&d(c(a.color))?c(a.color):'',borderRadius:a.borderRadius&&0<=parseInt(a.borderRadius,10)?parseInt(a.borderRadius,10):0,borderRadiusUnit:a.borderRadiusUnit?a.borderRadiusUnit:'px',borderColor:a.borderColor&&d(c(a.borderColor))?c(a.borderColor):'',borderStyle:_.contains(['none','dotted','dashed','double','solid'],a.borderStyle)?a.borderStyle:'none',borderWidth:a.borderWidth&&0<parseInt(a.borderWidth,10)?parseInt(a.borderWidth,10):1,borderWidthUnit:a.borderWidthUnit?a.borderWidthUnit:'px',backgroundColor:a.backgroundColor&&d(c(a.backgroundColor))?c(a.backgroundColor):'',backgroundRepeat:_.contains(['no-repeat','repeat','repeat-x','repeat-y'],a.backgroundRepeat)?a.backgroundRepeat:'no-repeat',backgroundPosition:_.contains(['left','center','right'],a.backgroundPosition)?a.backgroundPosition:'left',backgroundAttachment:_.contains(['scroll','fixed'],a.backgroundAttachment)?a.backgroundAttachment:'scroll',marginTop:a.marginTop?parseInt(a.marginTop,10):0,marginTopUnit:a.marginTopUnit?a.marginTopUnit:'px',marginLeft:a.marginLeft?parseInt(a.marginLeft,10):0,marginLeftUnit:a.marginLeftUnit?a.marginLeftUnit:'px',marginRight:a.marginRight?parseInt(a.marginRight,10):0,marginRightUnit:a.marginRightUnit?a.marginRightUnit:'px',marginBottom:a.marginBottom?parseInt(a.marginBottom,10):0,marginBottomUnit:a.marginBottomUnit?a.marginBottomUnit:'px',paddingTop:a.paddingTop&&0<=parseInt(a.paddingTop,10)?parseInt(a.paddingTop,10):0,paddingTopUnit:a.paddingTopUnit?a.paddingTopUnit:'px',paddingLeft:a.paddingLeft&&0<=parseInt(a.paddingLeft,10)?parseInt(a.paddingLeft,10):0,paddingLeftUnit:a.paddingLeftUnit?a.paddingLeftUnit:'px',paddingRight:a.paddingRight&&0<=parseInt(a.paddingRight,10)?parseInt(a.paddingRight,10):0,paddingRightUnit:a.paddingRightUnit?a.paddingRightUnit:'px',paddingBottom:a.paddingBottom&&0<=parseInt(a.paddingBottom,10)?parseInt(a.paddingBottom,10):0,paddingBottomUnit:a.paddingBottomUnit?a.paddingBottomUnit:'px'};if(b.fontWeight='',isNaN(a.fontWeight)?'bold'===a.fontWeight&&(b.fontWeight='bold'):700===parseInt(a.fontWeight,10)&&(b.fontWeight='bold'),b.textUnderline='',b.textLineThrough='',a.textDecoration&&'none'!==a.textDecoration){var e=_.compact(a.textDecoration.split(' '));_.contains(e,'underline')&&(b.textUnderline='underline'),_.contains(e,'line-through')&&(b.textLineThrough='line-through')}return b}},b.extend(e.controlConstructor,{sp_designer_css:e.SPDesigner.CSSControl}),e.bind('ready',function(){e.SPDesignerCustomizer.init()})}}(window.wp,jQuery);