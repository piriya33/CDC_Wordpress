jQuery(function(e){var t=e("#woocommerce-order-items"),o=!1,n={handle_events:function(){t.on("click","button.configure_bundle",{action:"configure"},this.clicked_edit_button).on("click","button.edit_bundle",{action:"edit"},this.clicked_edit_button)},clicked_edit_button:function(t){var i=e.WCBackboneModal.View.extend({addButton:n.clicked_done_button}),_=e(this).closest("tr.item").attr("data-order_item_id");return o=new i({target:"wc-modal-edit-bundle",string:{action:"configure"===t.data.action?wc_bundles_admin_order_params.i18n_configure:wc_bundles_admin_order_params.i18n_edit,item_id:_}}),n.populate_form(),!1},clicked_done_button:function(i){n.block(o.$el.find(".wc-backbone-modal-content"));var _=e.extend({},n.get_taxable_address(),{action:"woocommerce_edit_bundle_in_order",item_id:o._string.item_id,fields:o.$el.find("input, select, textarea").serialize(),dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce});e.post(woocommerce_admin_meta_boxes.ajax_url,_,function(e){e.result&&"success"===e.result?(t.find(".inside").empty(),t.find(".inside").append(e.html),"yes"===wc_bundles_admin_order_params.is_wc_version_gte_3_4?t.trigger("wc_order_items_reloaded"):(n.core.init_tiptip(),n.core.stupidtable.init()),n.unblock(o.$el.find(".wc-backbone-modal-content")),n.block(t,{fadeIn:0}),setTimeout(function(){n.unblock(t)},250),o.closeButton(i)):(window.alert(e.error?e.error:wc_bundles_admin_order_params.i18n_validation_error),n.unblock(o.$el.find(".wc-backbone-modal-content")))})},populate_form:function(){n.block(o.$el.find(".wc-backbone-modal-content"));var t={action:"woocommerce_configure_bundle_order_item",item_id:o._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(e){e.result&&"success"===e.result?(o.$el.find("form").html(e.html),n.unblock(o.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_bundles_admin_order_params.i18n_form_error),n.unblock(o.$el.find(".wc-backbone-modal-content")),o.$el.find(".modal-close").trigger("click"))})},get_taxable_address:function(){var t="",o="",n="",i="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(t=e("#_shipping_country").val(),o=e("#_shipping_state").val(),n=e("#_shipping_postcode").val(),i=e("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&t||(t=e("#_billing_country").val(),o=e("#_billing_state").val(),n=e("#_billing_postcode").val(),i=e("#_billing_city").val()),{country:t,state:o,postcode:n,city:i}},block:function(t,o){var n={message:null,overlayCSS:{background:"#fff",opacity:.6}},i=e.extend({},n,o||{});t.block(i)},unblock:function(e){e.unblock()}};"no"===wc_bundles_admin_order_params.is_wc_version_gte_3_4&&(n.core={init_tiptip:function(){e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),e(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},stupidtable:{init:function(){e(".woocommerce_order_items").stupidtable(),e(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(t,o){var n=e(this).find("th"),i="asc"===o.direction?"&uarr;":"&darr;",_=o.column;n.find(".wc-arrow").remove(),n.eq(_).append('<span class="wc-arrow">'+i+"</span>")}}}),n.handle_events()});