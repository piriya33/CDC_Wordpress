jQuery(function(i){var o=i("#woocommerce-order-items"),n=!1,_={handle_events:function(){o.on("click","button.configure_bundle",{action:"configure"},this.clicked_edit_button).on("click","button.edit_bundle",{action:"edit"},this.clicked_edit_button),i(document.body).on("click","input.bundled_product_checkbox",this.toggle_optional_item)},toggle_optional_item:function(e){var t=i(this),o=t.is(":checked"),t=t.closest(".details").find(".bundled_item_cart_content");o?t.show():t.hide()},clicked_edit_button:function(e){var t=i.WCBackboneModal.View.extend({addButton:_.clicked_done_button}),o=i(this).closest("tr.item").attr("data-order_item_id");return n=new t({target:"wc-modal-edit-bundle",string:{action:"configure"===e.data.action?wc_bundles_admin_order_params.i18n_configure:wc_bundles_admin_order_params.i18n_edit,item_id:o}}),_.populate_form(),!1},clicked_done_button:function(t){_.block(n.$el.find(".wc-backbone-modal-content"));var e=i.extend({},_.get_taxable_address(),{action:"woocommerce_edit_bundle_in_order",item_id:n._string.item_id,fields:n.$el.find("input, select, textarea").serialize(),dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce});i.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(o.find(".inside").empty(),o.find(".inside").append(e.html),"yes"===wc_bundles_admin_order_params.is_wc_version_gte_3_4?o.trigger("wc_order_items_reloaded"):(_.core.init_tiptip(),_.core.stupidtable.init()),"yes"===wc_bundles_admin_order_params.is_wc_version_gte_3_6&&e.notes_html&&(i("ul.order_notes").empty(),i("ul.order_notes").append(i(e.notes_html).find("li"))),_.unblock(n.$el.find(".wc-backbone-modal-content")),_.block(o,{fadeIn:0}),setTimeout(function(){_.unblock(o)},250),n.closeButton(t)):(window.alert(e.error||wc_bundles_admin_order_params.i18n_validation_error),_.unblock(n.$el.find(".wc-backbone-modal-content")))})},populate_form:function(){_.block(n.$el.find(".wc-backbone-modal-content"));var e={action:"woocommerce_configure_bundle_order_item",item_id:n._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_bundles_admin_order_params.edit_bundle_nonce};i.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(n.$el.find("form").html(e.html),_.unblock(n.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_bundles_admin_order_params.i18n_form_error),_.unblock(n.$el.find(".wc-backbone-modal-content")),n.$el.find(".modal-close").trigger("click"))})},get_taxable_address:function(){var e="",t="",o="",n="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=i("#_shipping_country").val(),t=i("#_shipping_state").val(),o=i("#_shipping_postcode").val(),n=i("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=i("#_billing_country").val(),t=i("#_billing_state").val(),o=i("#_billing_postcode").val(),n=i("#_billing_city").val()),{country:e,state:t,postcode:o,city:n}},block:function(e,t){t=i.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},t||{});e.block(t)},unblock:function(e){e.unblock()}};"no"===wc_bundles_admin_order_params.is_wc_version_gte_3_4&&(_.core={init_tiptip:function(){i("#tiptip_holder").removeAttr("style"),i("#tiptip_arrow").removeAttr("style"),i(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},stupidtable:{init:function(){i(".woocommerce_order_items").stupidtable(),i(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(e,t){var o=i(this).find("th"),n="asc"===t.direction?"&uarr;":"&darr;",t=t.column;o.find(".wc-arrow").remove(),o.eq(t).append('<span class="wc-arrow">'+n+"</span>")}}}),_.handle_events()});