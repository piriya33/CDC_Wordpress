/* GD bbPress Toolbox Pro - Core */
var gdbxRender,gdbxHelper;(function($,f,g,h){gdbxHelper={detect_msie:function(){var a=f.navigator.userAgent;var b=a.indexOf('MSIE ');if(b>0){return parseInt(a.substring(b+5,a.indexOf('.',b)),10)}var c=a.indexOf('Trident/');if(c>0){var d=a.indexOf('rv:');return parseInt(a.substring(d+3,a.indexOf('.',d)),10)}return 99},get_selection:function(){var t="";if(f.getSelection){t=f.getSelection()}else if(g.getSelection){t=g.getSelection()}else if(g.selection){t=g.selection.createRange().text}return $.trim(t.toString())},file_extension:function(a){return a.substr(a.lastIndexOf(".")+1).toLowerCase()},into_editor:function(a){var b=$("#bbp_topic_content").length>0?"bbp_topic_content":"bbp_reply_content";if(gdbxRender_Data.wp_editor&&!$("#"+b).is(":visible")){a+="<br/><br/>";if(gdbxRender_Data.wp_version>38){tinymce.get(b).execCommand("mceInsertContent",false,a)}else{tinyMCE.execInstanceCommand(b,"mceInsertContent",false,a)}}else{var c=$("#"+b);var d=c.val();if($.trim(d)!==""){a="\n\n"+a}a+="\n\n";c.val(d+a)}},scroll_to_editor:function(){if(gdbxHelper.detect_msie()>8){$("html, body").animate({scrollTop:$("#new-post").offset().top},1000)}else{g.location.href="#new-post"}$(".bbp-the-content-wrapper textarea").focus()}};gdbxRender={storage:{sending_report:false,files_counter:1,attachments_submit:true,attachments_extensions:[],attachments_enhanced:true},attachments:{init:function(){$("form#new-post").attr("enctype","multipart/form-data");$("form#new-post").attr("encoding","multipart/form-data");$(g).on("click",".bbp-attachment-insert",function(e){e.preventDefault();var a=$(this).attr("href").substr(1),shortcode='[attachment file="'+a+'"]';gdbxHelper.into_editor(shortcode);gdbxHelper.scroll_to_editor()});$(g).on("click",".bbp-attachment-confirm",function(e){if(!confirm(gdbxRender_Data.text_are_you_sure)){e.preventDefault()}});$(g).on("click",".d4p-attachment-addfile",function(e){e.preventDefault();if(!gdbxRender_Data.limiter||gdbxRender.storage.files_counter<gdbxRender_Data.max_files){$(this).before(gdbxRender.attachments.block());gdbxRender.storage.files_counter++}if(gdbxRender_Data.limiter&&gdbxRender.storage.files_counter===gdbxRender_Data.max_files){$(this).hide()}});if(gdbxRender.storage.attachments_enhanced){$(".bbp-attachments-form > div").addClass("bbp-validation-active");gdbxRender.attachments.validation()}},block:function(){var a="bbp-attachments-input",block;if(gdbxRender.storage.attachments_enhanced){a+=" bbp-validation-active"}else{a+=" bbp-validation-disabled"}block='<div class="'+a+'">';if(gdbxRender.storage.attachments_enhanced){block+='<div role="button" class="bbp-attachment-preview"><span aria-hidden="true">'+gdbxRender_Data.text_select_file+'</span></div>'}block+='<label><input type="file" size="40" name="d4p_attachment[]" />';block+='<span class="bbp-accessibility-show-for-sr">'+gdbxRender_Data.text_select_file+'</span></label>';if(gdbxRender.storage.attachments_enhanced){block+='<div class="bbp-attachment-control"></div>'}block+='</div>';return block},check_submit:function(){var a=true;$(".bbp-attachments-form .bbp-attachments-input").each(function(){if($(this).hasClass("bbp-attachment-invalid")){a=false}});$(".bbp-attachments-form").closest("form").find(".bbp-submit-wrapper button").attr("disabled",!a)},validation:function(){gdbxRender.storage.attachments_extensions=gdbxRender_Data.allowed_extensions.split(" ");$(g).on("click",".bbp-attachment-preview",function(){$(this).closest(".bbp-attachments-input").find("input[type=file]").click()});$(g).on("click",".bbp-attachments-input a.bbp-att-remove",function(e){e.preventDefault();$(this).closest(".bbp-attachments-input").fadeOut("slow",function(){gdbxRender.storage.files_counter--;$(".d4p-attachment-addfile").show();if(gdbxRender.storage.files_counter===0){$(this).after(gdbxRender.attachments.block());gdbxRender.storage.files_counter++}$(this).remove();gdbxRender.attachments.check_submit()})});$(g).on("click",".bbp-attachments-input a.bbp-att-caption",function(e){e.preventDefault();$(this).prev().find("input").show();$(this).hide()});$(g).on("click",".bbp-attachments-input a.bbp-att-shortcode",function(e){e.preventDefault();var a='[attachment file="'+$(this).data("file")+'"]';gdbxHelper.into_editor(a);gdbxHelper.scroll_to_editor()});$(g).on("change",".bbp-attachments-input input[type=file]",function(){if(!this.files){return}var a=$(this).closest(".bbp-attachments-input"),file=this.files[0],txt="",size=Math.round(file.size/1024),img="",limiter=gdbxRender_Data.limiter,valid=true,valid_size=true,valid_type=true,forbidden=["js","php"],ext=gdbxHelper.file_extension(file.name),regex=/^([a-zA-Z0-9\s_\\.\-:\+])+(.jpg|.jpeg|.gif|.png|.bmp)$/;a.removeClass("bbp-attachment-invalid");txt='<div>'+gdbxRender_Data.text_file_name+": <strong>"+file.name+"</strong></div>";txt+='<div>'+gdbxRender_Data.text_file_size+": <strong>"+size+" kb</strong>, ";txt+=gdbxRender_Data.text_file_type+": <strong>"+ext.toUpperCase()+"</strong></div>";if($.inArray(ext,forbidden)>-1){valid=false;valid_type=false}if(limiter&&file.size>gdbxRender_Data.max_size){valid=false;valid_size=false}if(limiter&&$.inArray(ext,gdbxRender.storage.attachments_extensions)===-1){valid=false;valid_type=false}if(!valid){txt+="<strong>";txt+=gdbxRender_Data.text_file_validation;if(!valid_type){txt+=" "+gdbxRender_Data.text_file_validation_type}if(!valid_size){txt+=" "+gdbxRender_Data.text_file_validation_size}txt+="</strong><br/>";a.addClass("bbp-attachment-invalid")}if(valid){txt+="<div><label><input name='d4p_attachment_caption[]' type='text' style='display: none' placeholder='"+gdbxRender_Data.text_file_caption_placeholder+"' /><span class='bbp-accessibility-show-for-sr'>"+gdbxRender_Data.text_file_caption_placeholder+"</span></label><a data-file='"+file.name+"' class='bbp-att-caption' href='#'>"+gdbxRender_Data.text_file_caption+"</a></div>";if(gdbxRender_Data.insert_into_content){txt+="<div><a class='bbp-att-shortcode' href='#'>"+gdbxRender_Data.text_file_shortcode+"</a></div>"}}txt+="<div><a class='bbp-att-remove' href='#'>"+gdbxRender_Data.text_file_remove+"</a></div>";a.find(".bbp-attachment-control").html(txt);a.find(".bbp-attachment-control .bbp-att-shortcode").data('file',file.name);a.find(".bbp-attachment-preview .bbp-attached-file").remove();if(f.FileReader&&regex.test(file.name.toLowerCase())){var b=new FileReader();b.readAsDataURL(file);b.onloadend=function(){img='<img class="bbp-attached-file" alt="'+file.name+'" src="'+this.result+'" />';a.find(".bbp-attachment-preview").prepend(img)}}else{img='<p class="bbp-attached-file" title="'+file.name+'">.'+ext.toUpperCase()+'</p>';a.find(".bbp-attachment-preview").prepend(img)}gdbxRender.attachments.check_submit()})}},bbcodes:{init:function(){$(".d4pbbc-spoiler").each(function(){var a=$(this).data("hover"),normal=$(this).data("color");$(this).hover(function(){$(this).css("background",a)},function(){$(this).css("background",normal)})})}},quotes:{init:function(){$(g).on("click",".d4p-bbt-quote-link",function(e){e.preventDefault();if($("#bbp_reply_content").length>0){var a=gdbxHelper.get_selection();var b=$(this).data("id");var c="#d4p-bbp-quote-"+b;if(a===""){a=$(c).html()}a=a.replace(/&nbsp;/g," ");a=a.replace(/<p>|<br>/g,"");a=a.replace(/<\/\s*p>/g,"\n");a=$("<div>").html(a).html();if(gdbxRender_Data.quote_method==="bbcode"){a="[quote quote="+b+"]"+a+"[/quote]"}else{var d='<div class="d4p-bbp-quote-title"><a href="'+$(this).data("url")+'">';d+=$(this).data("author")+' '+gdbxRender_Data.quote_wrote+':</a></div>';a='<blockquote class="d4pbbc-quote">'+d+a+'</blockquote>'}gdbxHelper.into_editor(a);gdbxHelper.scroll_to_editor()}})}},canned_replies:{init:function(){$(".gdbbx-canned-replies .gdbbx-canned-replies-show").click(function(e){e.preventDefault();var a=$(this).closest(".gdbbx-canned-replies");$(this).hide();$(".gdbbx-canned-replies-hide",a).show();$(".gdbbx-canned-replies-list",a).slideDown()});$(".gdbbx-canned-replies .gdbbx-canned-replies-hide").click(function(e){e.preventDefault();var a=$(this).closest(".gdbbx-canned-replies");$(this).hide();$(".gdbbx-canned-replies-show",a).show();$(".gdbbx-canned-replies-list",a).slideUp()});$(".gdbbx-canned-replies .gdbbx-canned-reply-insert").click(function(e){e.preventDefault();var a=$(this).closest(".gdbbx-canned-reply"),content=$(".gdbbx-canned-reply-content",a).html();gdbxHelper.into_editor(content);if(gdbxRender_Data.auto_close_on_insert){var b=$(this).closest(".gdbbx-canned-replies");$(".gdbbx-canned-replies-hide",b).click()}})}},fitvids:{init:function(){$(".bbp-topic-content, .bbp-reply-content").fitVids()}},report:{init:function(){$(".d4p-bbt-report-link").click(function(e){e.preventDefault();if(!gdbxRender.storage.sending_report){if(gdbxRender_Data.report_mode==="form"){gdbxRender.report.form($(this))}else{gdbxRender.report.button($(this))}}})},button:function(b){var c=b.data("id"),post_type=b.data("post-type"),type=b.data("type"),nonce=b.data("nonce");if(gdbxRender_Data.report_mode==="confirm"){if(confirm(gdbxRender_Data.report_confirm)===false){return}}var d={post:c,nonce:nonce};gdbxRender.storage.sending_report=true;$.ajax({dataType:"html",type:"post",data:d,url:gdbxRender_Data.url+"?action=gdbbx_report_post",success:function(a){gdbxRender.storage.sending_report=false;$(".d4p-bbt-report-link-"+d.post).replaceWith("<span>"+gdbxRender_Data.report_after+"</span>")}})},form:function(a){var b=a.data("id"),post_type=a.data("post-type"),type=a.data("type"),nonce=a.data("nonce"),forums=a.closest("#bbpress-forums"),content=a.closest("#bbpress-forums").find(".post-"+b+" .bbp-reply-content, .post-"+b+" .bbp-topic-content");if(content.length===1){if(content.find(".gdbbx-report-wrapper").length===0){$(".gdbbx-report-wrapper").remove();var c=$(".gdbbx-report-template > div").clone().addClass("gdbbx-report-wrapper");c.find("button").data("id",b).data("nonce",nonce);content.append(c);c.find("input").focus();gdbxRender.report.handle(content.find(".gdbbx-report-wrapper"))}if(gdbxRender_Data.report_scroll){var d=0;if($("#wpadminbar").length>0){d=$("#wpadminbar").height()}$("html, body").animate({scrollTop:content.find(".gdbbx-report-wrapper").offset().top-d},500)}}},handle:function(d){$("button.gdbbx-report-cancel",d).click(function(){$(".gdbbx-report-wrapper").remove()});$("button.gdbbx-report-send",d).click(function(){var b=$("input",d).val();if(b.length<gdbxRender_Data.report_min){alert(gdbxRender_Data.report_alert)}else{var c={report:b,post:$(this).data("id"),nonce:$(this).data("nonce")};$(".gdbbx-report-form",d).hide();$(".gdbbx-report-sending",d).show();gdbxRender.storage.sending_report=true;$.ajax({dataType:"html",type:"post",data:c,url:gdbxRender_Data.url+"?action=gdbbx_report_post",success:function(a){gdbxRender.storage.sending_report=false;$(".gdbbx-report-sending",d).hide();$(".gdbbx-report-sent",d).show();$(".d4p-bbt-report-link-"+c.post).replaceWith("<span>"+gdbxRender_Data.report_after+"</span>")}})}})}},thanks:{init:function(){$(".d4p-bbt-thanks-link, .d4p-bbt-unthanks-link").click(function(e){e.preventDefault();gdbxRender.thanks.handle(this)})},handle:function(c){var d={nonce:$(c).data("thanks-nonce"),say:$(c).data("thanks-action"),id:$(c).data("thanks-id")},button=$(c),is_thanks=button.hasClass("d4p-bbt-thanks-link");$.ajax({dataType:"html",type:"post",data:d,url:gdbxRender_Data.url+"?action=gdbbx_say_thanks",success:function(a){var b=$(a).fadeIn(600);$(".gdbbx-thanks-post-"+d.id).fadeOut(400).replaceWith(b);if(is_thanks){if(gdbxRender_Data.thanks_removal){button.removeClass("d4p-bbt-thanks-link").addClass("d4p-bbt-unthanks-link").data("thanks-action","unthanks").html(gdbxRender_Data.thanks_unthanks)}else{button.replaceWith("<span>"+gdbxRender_Data.thanks_saved+"</span>")}}else{button.removeClass("d4p-bbt-unthanks-link").addClass("d4p-bbt-thanks-link").data("thanks-action","thanks").html(gdbxRender_Data.thanks_thanks)}}})}},misc:{privacy:function(){$(".gdbbx-private-reply-hidden").each(function(){$(this).hide().prev(".bbp-reply-header").hide()})}},run:function(){if(typeof gdbxRender_Data!=="undefined"){gdbxRender.misc.privacy();if(gdbxRender_Data.run_quote){gdbxRender.quotes.init()}if(gdbxRender_Data.run_attachments){gdbxRender.storage.attachments_enhanced=gdbxRender_Data.validate_attachments&&gdbxHelper.detect_msie()>9;gdbxRender.attachments.init()}if(gdbxRender_Data.run_bbcodes){gdbxRender.bbcodes.init()}if(gdbxRender_Data.run_report){gdbxRender.report.init()}if(gdbxRender_Data.run_thanks){gdbxRender.thanks.init()}if(gdbxRender_Data.run_canned_replies){gdbxRender.canned_replies.init()}if(gdbxRender_Data.run_fitvids&&$.fn.fitVids){gdbxRender.fitvids.init()}}}};gdbxRender.run()})(jQuery,window,document);
