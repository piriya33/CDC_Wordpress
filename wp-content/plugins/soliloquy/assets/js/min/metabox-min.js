function SoliloquySlidesUpdate(e){SoliloquySlides.reset();var t="ul#soliloquy-output li.soliloquy-slide"+(e?".selected":"");jQuery(t).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-soliloquy-image-model"));SoliloquySlides.add(new SoliloquySlide(e))})}!function($,e,t,i){"use strict";var o={init:function(){this.select_all(),this.sortable(),this.select(),this.display(),this.chosen(),this.slide_size(),this.uploadImage(),this.toggleStatus(),this.tooltip(),this.sort_slides(),this.clear_selected(),new Clipboard(".soliloquy-clipboard"),$("ul#soliloquy-output").on("click","a.check",function(e){e.preventDefault()}),$(".soliloquy-clipboard").on("click",function(e){e.preventDefault()});var e=$("#soliloquy-output li").length;$(".soliloquy-count").text(e.toString()),$("input,select").conditional()},toggleStatus:function(){$("#soliloquy-settings-content").on("click.soliloquyStatus",".soliloquy-slide-status",function(e){if(e.preventDefault(),$(this).hasClass("list-status"))var t=$(this).parent().parent().parent();else var t=$(this).parent();var o=$(this),l=o.data("status"),s=t.find(".soliloquy-slide-status.list-status"),a=t.find(".soliloquy-slide-status.grid-status"),n=o.parent().parent().data("view"),d=o.data("id"),r=a.find("span.dashicons"),u=s.find("span"),c=o.data("soliloquy-tooltip");if("active"===l)var h="pending";else var h="active";var m={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_change_slide_status",post_id:i.id,slide_id:d,status:h,nonce:i.save_nonce},success:function(e){"active"===h?(a.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),s.removeClass("soliloquy-draft-slide").addClass("soliloquy-active-slide"),r.removeClass("dashicons-hidden").addClass("dashicons-visibility"),u.text(i.active),a.attr("data-soliloquy-tooltip",i.active),s.data("status","active"),a.data("status","active")):(a.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),s.removeClass("soliloquy-active-slide").addClass("soliloquy-draft-slide"),r.removeClass("dashicons-visibility").addClass("dashicons-hidden"),u.text(i.draft),s.data("status","pending"),a.data("status","pending"),a.attr("data-soliloquy-tooltip",i.draft))},error:function(e,t,i){}};$.ajax(m)})},tooltip:function(){$("[data-soliloquy-tooltip]").on("mouseover",function(e){e.preventDefault();var t=$(this),i=t.data("soliloquy-tooltip")})},select_all:function(){$(".soliloquy-select-all").change(function(){var e=this.checked;if(e){$("ul#soliloquy-output li").addClass("selected"),$(".soliloquy-bulk-actions").fadeIn();var t=$("ul#soliloquy-output li.selected").length;$(".select-all").text(i.selected),$(".soliloquy-count").text(t.toString()),$(".soliloquy-clear-selected").fadeIn()}else{$("ul#soliloquy-output li").removeClass("selected"),$(".soliloquy-bulk-actions").fadeOut();var o=$("ul#soliloquy-output li").length;$(".select-all").text(i.select_all),$(".soliloquy-count").text(o.toString()),$(".soliloquy-clear-selected").fadeOut()}})},sort_slides:function(){$(t).on("change","#soliloquy-config-slide-sort",function(){var e=$(this),t=e.val(),l={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_publish",post_id:i.id,order:t,nonce:i.save_nonce},success:function(e){e&&($("#soliloquy-output").html(e.data),SoliloquySlidesUpdate(),"manual"===t?(console.log(t),$("#soliloquy-output").attr("data-sortable","1")):$("#soliloquy-output").attr("data-sortable","0"),o.sortable())},error:function(e,t,i){}};$.ajax(l)})},sortable:function(){var e=$("#soliloquy-output"),t=e.attr("data-sortable");console.log(t),"1"===t?(e.hasClass("ui-sortable")&&e.sortable("enable"),e.sortable({containment:"#soliloquy-slider-main",items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",update:function(t,o){var l={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_sort_images",order:e.sortable("toArray").toString(),post_id:i.id,nonce:i.sort},success:function(e){SoliloquySlidesUpdate()},error:function(e,t,i){}};$.ajax(l)}})):e.hasClass("ui-sortable")&&e.sortable("disable")},select:function(){var e=!1,o=!1;$("li.soliloquy-slide .soliloquy-item-content, .soliloquy-list li a.check").on("click",function(t){var l=$(this),s=$(this).parent();if(t.preventDefault(),$(s).hasClass("selected")){$(s).removeClass("selected"),o=!1;var a=$("ul#soliloquy-output li.selected").length;if(0!==a)$(".select-all").text(i.selected),$(".soliloquy-count").text(a.toString()),$(".soliloquy-clear-selected").fadeIn();else{var n=$("ul#soliloquy-output li").length;$(".select-all").text(i.select_all),$(".soliloquy-count").text(n.toString()),$(".soliloquy-clear-selected").fadeOut()}}else{if(e&&o!==!1){var d=$("ul#soliloquy-output li").index($(o)),r=$("ul#soliloquy-output li").index($(s)),u=0;if(d<r)for(u=d;u<=r;u++)$("ul#soliloquy-output li:eq( "+u+")").addClass("selected");else for(u=r;u<=d;u++)$("ul#soliloquy-output li:eq( "+u+")").addClass("selected")}$(s).addClass("selected"),o=$(s),a=$("ul#soliloquy-output li.selected").length,$(".soliloquy-clear-selected").fadeIn(),$(".select-all").text(i.selected),$(".soliloquy-count").text(a.toString())}$("ul#soliloquy-output > li.selected").length>0?$(".soliloquy-bulk-actions").fadeIn():$(".soliloquy-bulk-actions").fadeOut()}),$(t).on("keyup keydown",function(t){e=t.shiftKey})},slide_size:function(){$(t).on("change","#soliloquy-config-slider-size",function(){var e=$(this),t=e.val(),o=e.find(":selected").data("soliloquy-width"),l=e.find(":selected").data("soliloquy-height");"default"===t&&($("#soliloquy-config-slider-width").val(i.slide_width),$("#soliloquy-config-slider-height").val(i.slide_height)),o&&$("#soliloquy-config-slider-width").val(o),l&&$("#soliloquy-config-slider-height").val(l)})},clear_selected:function(){$(".soliloquy-clear-selected").on("click",function(e){e.preventDefault();var t=$("#soliloquy-output li").length;$("ul#soliloquy-output li").removeClass("selected"),$(".select-all").text(i.select_all),$(".soliloquy-count").text(t.toString()),$(".soliloquy-select-all").prop("checked",!1),$(".soliloquy-bulk-actions").fadeOut(),$(this).fadeOut()})},display:function(){$("a.soliloquy-display").on("click",function(e){if(e.preventDefault(),!$(this).hasClass("active-display")){var t=$(this),o=t.data("soliloquy-display"),l=$("#soliloquy-output"),s={url:i.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"soliloquy_slider_view",post_id:i.id,view:o,nonce:i.save_nonce},success:function(e){}};$.ajax(s),$(".soliloquy-display-toggle").find(".active-display").removeClass("active-display"),t.addClass("active-display"),"grid"===o?l.removeClass("soliloquy-list").addClass("soliloquy-grid"):"list"===o&&l.removeClass("soliloquy-grid").addClass("soliloquy-list")}})},chosen:function(){$(".soliloquy-chosen").each(function(){var e=$(this).data("soliloquy-chosen-options");$(this).chosen(e)})},uploadImage:function(){$(".soliloquy-insert-image").on("click",function(e){var t;e.preventDefault();var o=$(event.currentTarget),l=o.parent().find("input");return t?void t.open():(t=wp.media.frames.soliloquy_image_frame=wp.media({frame:"select",library:{type:"image"},title:i.insert_image,button:{text:i.insert_image},contentUserSetting:!1,multiple:!1}),t.on("select",function(){var e=t.state().get("selection").first().toJSON();l.val(e.url)}),void t.open())})},updateSlideCount:function(){var e=$("#soliloquy-output li").length;$(".soliloquy-count").text(e.toString()),e>0&&($("#soliloquy-empty-slider").fadeOut().addClass("soliloquy-hidden"),$(".soliloquy-slide-header").removeClass("soliloquy-hidden").fadeIn(),$(".soliloquy-bulk-actions").fadeOut())}};$(function(){o.init()}),$(t).on("soliloquyType",function(){o.init()}),$(t).on("insertSlides",function(){o.updateSlideCount()})}(jQuery,window,document,soliloquy_metabox),function($,e,t,i){"use strict";$(function(){$("#soliloquy-types-nav").on("click","li",function(e){$(this).hasClass("soliloquy-active")||$('input[name="_soliloquy[type]"]',$(this)).prop("checked",!0).trigger("change")}),$(t).on("change",'input[name="_soliloquy[type]"]:radio',function(e){var o=$("#soliloquy-tabs #soliloquy-tab-images .spinner"),l=$("#soliloquy-slider-main");$("a",$("#soliloquy-settings-tabs li").first()).trigger("click"),$(l).html(""),$(o).css("visibility","visible"),$("li",$(this).closest("#soliloquy-types-nav")).removeClass("soliloquy-active"),$(this).closest("li").addClass("soliloquy-active"),$.ajax({type:"post",url:i.ajax,dataType:"json",data:{action:"soliloquy_change_type",post_id:i.id,type:$(this).val(),nonce:i.change_nonce},success:function(e){$(l).html(e.html),$(t).trigger("soliloquyType",e),$(o).hide()},error:function(e,t){$(l).html('<div class="error"><p>'+e.responseText+"</p></div>"),$(o).hide()}})})})}(jQuery,window,document,soliloquy_metabox),jQuery(document).ready(function($){$("a.soliloquy-slides-delete").click(function(e){e.preventDefault();var t=confirm(soliloquy_metabox.remove_multiple);if(!t)return!1;var i=[];$("ul#soliloquy-output > li.selected").each(function(){i.push($(this).attr("id"))});var o={action:"soliloquy_remove_slides",attachment_ids:i,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};$.post(soliloquy_metabox.ajax,o,function(e){$("ul#soliloquy-output > li.selected").remove(),$(".soliloquy-bulk-actions").fadeOut(),$(".soliloquy-select-all").prop("checked",!1),$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var t=$("#soliloquy-output li").length;$(".soliloquy-count").text(t.toString()),0===t&&($(".soliloquy-bulk-actions").fadeOut(),$(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),$("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())},"json")}),$("#soliloquy-settings-content ").on("click",".soliloquy-remove-slide",function(e){e.preventDefault();var t=confirm(soliloquy_metabox.remove);if(t){var i=$(this).parent().attr("id"),o={action:"soliloquy_remove_slide",attachment_id:i,post_id:soliloquy_metabox.id,nonce:soliloquy_metabox.remove_nonce};$.post(soliloquy_metabox.ajax,o,function(e){$("#"+i).fadeOut("normal",function(){$(this).remove(),$(".soliloquy-load-library").attr("data-soliloquy-offset",0).addClass("has-search").trigger("click"),SoliloquySlidesUpdate(!1);var e=$("#soliloquy-output li").length;$(".soliloquy-count").text(e.toString()),0===e&&($(".soliloquy-bulk-actions").fadeOut(),$(".soliloquy-slide-header").fadeOut().addClass("soliloquy-hidden"),$("#soliloquy-empty-slider").removeClass("soliloquy-hidden").fadeIn())})},"json")}})});var SoliloquySlide=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:"",type:""}}),SoliloquySlides=new Backbone.Collection,SoliloquyModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}}),SoliloquyView=wp.Backbone.View.extend({id:"soliloquy-meta-edit",tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("soliloquy-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","keyup .CodeMirror":"updateCode","blur textarea":"updateItem","change select":"updateItem","click a.soliloquy-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click a.soliloquy-thumbnail":"insertThumb","click a.soliloquy-thumbnail-delete":"removeThumb","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var t=0;this.collection.each(function(e){return String(e.get("id"))==String(this.attachment_id)?(this.model=e,this.attachment_index=t,!1):void t++},this)},updateCode:function(e){$model=this.model,$textarea=this.$el.find(".soliloquy-html-slide-code"),$model.set("code",this.editor.getValue(),{silent:!0}),$textarea.text()},insertThumb:function(e){$model=this.model,e.preventDefault();var t=this.$el.data("field"),i=wp.media.frames.soliloquy_media_frame=wp.media({className:"media-frame soliloquy-media-frame",frame:"select",multiple:!1,title:soliloquy_metabox.videoframe,library:{type:"image"},button:{text:soliloquy_metabox.videouse}});i.on("select",function(){var e=i.state().get("selection").first().toJSON();$model.set("src",e.url,{silent:!0}),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",e.url)}),i.open()},removeThumb:function(e){e.preventDefault(),$model=this.model,$parent=this.$el.parent(),jQuery("div.thumbnail > img",$parent.find(".media-frame-content")).attr("src",""),$model.set("src","",{silent:!0})},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),textarea=this.$el.find(".soliloquy-html-slide-code"),textarea.length&&(this.editor=CodeMirror.fromTextArea(textarea[0],{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"ttcn"})),this.$el.trigger("soliloquyRenderMeta"),this},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&alert(e)},loadPreviousItem:function(){this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(){this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("soliloquy_save_meta",{context:this,data:{nonce:soliloquy_metabox.save_nonce,post_id:soliloquy_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var t=JSON.stringify(this.model.attributes);jQuery("ul#soliloquy-output li#"+this.model.get("id")).attr("data-soliloquy-image-model",t);var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("soliloquy_get_attachment_links",{context:this,data:{nonce:soliloquy_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),SoliloquyChildViews=[],SoliloquyContentViews=[];!function($){$(document).ready(function(){soliloquy_edit={init:function(){SoliloquySlidesUpdate(),$("#soliloquy-settings-content").on("click.soliloquyModify",".soliloquy-modify-slide",function(e){e.preventDefault();var t=$(this).parent().data("soliloquy-slide");SoliloquyModalWindow.content(new SoliloquyView({collection:SoliloquySlides,child_views:SoliloquyChildViews,attachment_id:t})),$(document).trigger("soliloquyRenderMeta"),SoliloquyModalWindow.open(),$(document).trigger("soliloquyEditOpen"),$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})})}},soliloquy_edit.init()}),$(document).on("soliloquyUploaded",function(){soliloquy_edit.init()})}(jQuery),function($,e,t){wp.media.view.SoliloquyHTMLError=wp.Backbone.View.extend({tagName:"div",className:"soliloquy-error soliloquy-html-error",render:function(){return this.template=wp.media.template("soliloquy-html-error"),this.$el.html(this.template(this.model)),this}}),wp.media.model.SoliloquyHTML=Backbone.Model.extend({defaults:{title:"",code:""}}),wp.media.view.SoliloquyHTMLItem=wp.Backbone.View.extend({tagName:"li",className:"attachment soliloquy-html-attachment",events:{"keyup input":"updateItem","keyup textarea":"updateItem","blur .Codemirror":"updateCode","click .soliloquy-delete-html-slide":"deleteItem","click .soliloquy-item-collapse":"collapse"},initialize:function(){this.model.view=this},collapse:function(e){var t=$(this.$el);$text=t.find(".soliloquy-item-collapse"),e.preventDefault(),t.find(".soliloquy-item-setting").not(".title").is(":visible")?($text.text(soliloquy_metabox.expand),t.find(".soliloquy-item-setting").not(".title").fadeOut()):($text.text(soliloquy_metabox.collapse),t.find(".soliloquy-item-setting").not(".title").fadeIn())},updateCode:function(e){},updateItem:function(e){this.model.set(e.target.name,e.target.value,{silent:!0})},deleteItem:function(e){this.trigger("loading");var t=jQuery(e.target);t.parent().parent().parent().remove(),this.model.destroy(),this.trigger("loaded loaded:success")},updateCode:function(e){},render:function(){this.template=wp.media.template("soliloquy-html-item"),this.$el.html(this.template(this.model.toJSON()));var e=this.$el.find(".soliloquy-html-slide-code");return this.editor=CodeMirror.fromTextArea(e[0],{enterMode:"keep",indentUnit:4,electricChars:!1,lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,mode:"php",smartIndent:!1,tabMode:"shift",theme:"ttcn"}),this.editor.on("blur",function(t){this.model.set("code",t.getValue(),{silent:!0}),e.text(t.getValue())}),this}}),wp.media.view.Toolbar.SoliloquyHTML=wp.media.view.Toolbar.extend({initialize:function(){_.defaults(this.options,{event:"soliloquy_html_insert",close:!1,items:{soliloquy_html_insert:{id:"soliloquy-html-button",style:"primary",text:wp.media.view.l10n.insertIntoPost,priority:80,requires:!1,click:function(){this.controller.state().SoliloquyHTMLInsert()}}}}),wp.media.view.Toolbar.prototype.initialize.apply(this,arguments)},refresh:function(){this.get("soliloquy_html_insert").model.set("disabled",!1),wp.media.view.Toolbar.prototype.refresh.apply(this,arguments)}}),wp.media.view.SoliloquyHTML=wp.media.View.extend({events:{"click .soliloquy-html-add":"addItem",change:"refreshView"},initialize:function(){this.collection=new Backbone.Collection,this.is_loading=!1,this.$el.prepend(wp.media.template("soliloquy-html-router")),this.$el.prepend(wp.media.template("soliloquy-html-side-bar")),this.$el.prepend(wp.media.template("soliloquy-html-items")),this.addItem(),setTimeout(function(){$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})},100),this.on("loading",this.loading,this),this.on("loaded",this.loaded,this)},loading:function(){this.is_loading=!0,this.$el.find(".spinner").addClass("is-active")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").removeClass("is-active"),this.$el.find("div.soliloquy-error").remove(),"object"==typeof e&&(e=e.responseText),"undefined"!=typeof e&&(this.$el.find("div.media-toolbar-secondary").append(this.renderError(e)),this.$el.find("ul.attachments.soliloquy-html-attachments").css("margin-top",this.$el.find("div.soliloquy-error").height()+20)),this.controller.toolbar.get().refresh()},clearItems:function(){this.$el.find("ul.soliloquy-html-attachments").empty()},renderError:function(e){var t={};t.error=e;var i=new wp.media.view.SoliloquyHTMLError({model:t});return i.render().el},addItem:function(e){this.trigger("loading"),model=new wp.media.model.SoliloquyHTML,this.getSelection().add(model);var t=new wp.media.view.SoliloquyHTMLItem({model:model,controller:this});this.$el.find("ul.soliloquy-html-attachments").append(t.render().el),$(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()}),this.trigger("loaded loaded:success")},refreshView:function(e){},getSelection:function(){return this.controller.state().props},clearSelection:function(){this.selection=this.getSelection(),jQuery("li.attachment.soliloquy-html-attachment").remove(),this.selection.reset()}});var i=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this.states.add([new wp.media.controller.SoliloquyHTML({id:"soliloquy-html",content:"soliloquy-html-content",toolbar:"soliloquy-html-toolbar",menu:"default",title:wp.media.view.l10n.SoliloquyHTMLTitle,priority:200,type:"link"})]),this.on("content:render:soliloquy-html-content",this.renderSoliloquyHTMLContent,this),this.on("toolbar:create:soliloquy-html-toolbar",this.createSoliloquyHTMLToolbar,this)},renderSoliloquyHTMLContent:function(){this.content.set(new wp.media.view.SoliloquyHTML({controller:this,model:this.state().props,className:"attachments-browser soliloquy soliloquy-html"}))},createSoliloquyHTMLToolbar:function(e){e.view=new wp.media.view.Toolbar.SoliloquyHTML({controller:this})}}),wp.media.controller.SoliloquyHTML=wp.media.controller.State.extend({initialize:function(e){this.props=new Backbone.Collection},SoliloquyHTMLInsert:function(){var e=this.frame.content.get(),i=[],o=!0;return this.button=this.frame.toolbar.get().get("soliloquy_html_insert"),this.button.model.set("text",wp.media.view.l10n.inserting),this.button.model.set("disabled",!0),e.trigger("loading"),e.getSelection().each(function(e){""==e.get("title")&&(o=!1),""==e.get("code")&&(o=!1),i.push(e.toJSON())},this),o?void wp.media.ajax("soliloquy_insert_slides",{context:this,data:{nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,html:i},success:function(i){jQuery("#soliloquy-output").html(i),e.trigger("loaded loaded:success"),SoliloquySlidesUpdate(),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),$(t).trigger("insertSlides"),e.clearSelection(),this.frame.close()},error:function(t){this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),e.trigger("loaded loaded:error",t)}}):(e.trigger("loaded loaded:error",wp.media.view.l10n.SoliloquyHTMLValidationError),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),!1)}})}(jQuery,window,document),function($,e,t,i){wp.media.view.SoliloquyVideosError=wp.Backbone.View.extend({tagName:"div",className:"soliloquy-error soliloquy-videos-error",render:function(){return this.template=wp.media.template("soliloquy-video-error"),this.$el.html(this.template(this.model)),this}}),wp.media.model.SoliloquyVideo=Backbone.Model.extend({defaults:{title:"",url:"",src:"",caption:"",alt:"",hosted_video:!1}}),wp.media.view.SoliloquyVideosItem=wp.Backbone.View.extend({tagName:"li",className:"attachment soliloquy-videos-attachment",events:{"keyup input":"updateItem","keyup textarea":"updateItem","click .soliloquy-delete-video-slide":"deleteItem","click .soliloquy-insert-video":"insertVideo","click .soliloquy-insert-placeholder":"insertPlaceholder","click .soliloquy-item-collapse":"collapse"},initialize:function(){this.model.view=this},collapse:function(e){var t=$(this.$el);$text=t.find(".soliloquy-item-collapse"),e.preventDefault(),t.find(".soliloquy-item-setting").not(".title").is(":visible")?($text.text(i.expand),t.find(".soliloquy-item-setting").not(".title").fadeOut()):($text.text(i.collapse),t.find(".soliloquy-item-setting").not(".title").fadeIn())},updateItem:function(e){this.model.set(e.target.name,e.target.value,{silent:!0}),"url"==e.target.name&&(""==e.target.value?this.model.set("hosted_video",!1):wp.media.ajax("soliloquy_is_hosted_video",{context:this,data:{nonce:i.hosted_nonce,video_url:e.target.value},success:function(e){e?this.model.set("hosted_video",!0):this.model.set("hosted_video",!1)},error:function(e){this.model.set("hosted_video",!1),this.frame.content.get().trigger("loaded loaded:error",e)}}))},insertVideo:function(e){var t,o=this.model;e.preventDefault();var l=$(e.currentTarget),s=l.parent().parent().find("input");return t?void t.open():(t=wp.media.frames.soliloquy_video_frame=wp.media({frame:"select",library:{type:"video"},title:i.insert_video,button:{text:i.insert_video},contentUserSetting:!1,multiple:!1}),t.on("select",function(){attachment=t.state().get("selection").first().toJSON(),$value=s.val(attachment.url),o.set("url",attachment.url,{silent:!0})}),void t.open())},insertPlaceholder:function(e){var t,o=this.model;e.preventDefault();var l=$(e.currentTarget),s=l.parent().parent().find("input");return t?void t.open():(t=wp.media.frames.soliloquy_placeholder_frame=wp.media({frame:"select",library:{type:"image"},title:i.insert_placeholder,button:{text:i.insert_placeholder},contentUserSetting:!1,multiple:!1}),t.on("select",function(){attachment=t.state().get("selection").first().toJSON(),s.val(attachment.url),o.set("src",attachment.url,{silent:!0})}),void t.open())},deleteItem:function(e){this.trigger("loading");var t=jQuery(e.target);t.parent().parent().parent().remove(),this.model.destroy(),this.trigger("loaded loaded:success")},render:function(){return this.template=wp.media.template("soliloquy-video-item"),this.$el.html(this.template(this.model.toJSON())),this}}),wp.media.view.Toolbar.SoliloquyVideos=wp.media.view.Toolbar.extend({initialize:function(){_.defaults(this.options,{event:"soliloquy_videos_insert",close:!1,items:{soliloquy_videos_insert:{id:"soliloquy-videos-button",style:"primary",text:wp.media.view.l10n.insertIntoPost,priority:80,requires:!1,click:function(){this.controller.state().SoliloquyVideosInsert()}}}}),wp.media.view.Toolbar.prototype.initialize.apply(this,arguments)},refresh:function(){this.get("soliloquy_videos_insert").model.set("disabled",!1),wp.media.view.Toolbar.prototype.refresh.apply(this,arguments)}}),wp.media.view.SoliloquyVideos=wp.media.View.extend({events:{"click .soliloquy-videos-add":"addItem",change:"refreshView"},initialize:function(){this.collection=new Backbone.Collection,this.is_loading=!1,this.$el.prepend(wp.media.template("soliloquy-video-router")),this.$el.prepend(wp.media.template("soliloquy-video-side-bar")),this.$el.prepend(wp.media.template("soliloquy-video-items")),this.addItem(),this.on("loading",this.loading,this),this.on("loaded",this.loaded,this)},loading:function(){this.is_loading=!0,this.$el.find(".spinner").addClass("is-active")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").removeClass("is-active"),this.$el.find("div.soliloquy-error").remove(),"object"==typeof e&&(e=e.responseText),"undefined"!=typeof e&&(this.$el.find("div.media-toolbar-secondary").append(this.renderError(e)),this.$el.find("ul.attachments.soliloquy-videos-attachments").css("margin-top",this.$el.find("div.soliloquy-error").height()+20)),this.controller.toolbar.get().refresh()},clearItems:function(){this.$el.find("ul.soliloquy-videos-attachments").empty()},renderError:function(e){var t={};t.error=e;var i=new wp.media.view.SoliloquyVideosError({model:t});return i.render().el},addItem:function(e){this.trigger("loading"),model=new wp.media.model.SoliloquyVideo,this.getSelection().add(model);var t=new wp.media.view.SoliloquyVideosItem({model:model,controller:this});this.$el.find("ul.soliloquy-videos-attachments").append(t.render().el),setTimeout(function(){quicktags({id:"caption-video",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),this.trigger("loaded loaded:success")},refreshView:function(e){this.model.each(function(e){e.get("hosted_video")?e.view.$el.find("div.image").fadeIn():e.view.$el.find("div.image").fadeOut()})},getSelection:function(){return this.controller.state().props},clearSelection:function(){this.selection=this.getSelection(),jQuery("li.attachment.soliloquy-videos-attachment").remove(),this.selection.reset()}});var o=wp.media.view.MediaFrame.Post;wp.media.view.MediaFrame.Post=o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),this.states.add([new wp.media.controller.SoliloquyVideos({id:"soliloquy-videos",content:"soliloquy-videos-content",toolbar:"soliloquy-videos-toolbar",menu:"default",title:wp.media.view.l10n.soliloquyVideosTitle,priority:200,type:"link"})]),this.on("content:render:soliloquy-videos-content",this.renderSoliloquyVideosContent,this),this.on("toolbar:create:soliloquy-videos-toolbar",this.createSoliloquyVideosToolbar,this)},renderSoliloquyVideosContent:function(){this.content.set(new wp.media.view.SoliloquyVideos({controller:this,model:this.state().props,className:"attachments-browser soliloquy soliloquy-videos"}))},createSoliloquyVideosToolbar:function(e){e.view=new wp.media.view.Toolbar.SoliloquyVideos({controller:this})}}),wp.media.controller.SoliloquyVideos=wp.media.controller.State.extend({initialize:function(e){this.props=new Backbone.Collection},renderError:function(e){var t={};t.error=e;var i=new wp.media.view.SoliloquyVideosError({model:t});return i.render().el},SoliloquyVideosInsert:function(){var e=this.frame.content.get(),o=[],l=!0;return this.button=this.frame.toolbar.get().get("soliloquy_videos_insert"),this.button.model.set("text",wp.media.view.l10n.inserting),this.button.model.set("disabled",!0),e.trigger("loading"),e.getSelection().each(function(e){""===e.get("title")&&(l=!1),""===e.get("url")&&(l=!1),""===e.get("src")&&(l=!0),e.get("hosted_video")&&""===e.get("src")&&(l=!1),o.push(e.toJSON())},this),l?void wp.media.ajax("soliloquy_insert_slides",{context:this,data:{nonce:i.insert_nonce,post_id:i.id,videos:o},success:function(i){jQuery("#soliloquy-output").html(i),e.trigger("loaded loaded:success"),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),SoliloquySlidesUpdate(),$(t).trigger("insertSlides"),e.clearSelection(),this.frame.close()},error:function(t){this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),$(".soliloquy-videos").find("div.media-toolbar-secondary").append(this.renderError(t.statusText)),e.trigger("soliloquy-loaded soliloquy-loaded:error",t.statusText)}}):(e.trigger("loaded loaded:error",wp.media.view.l10n.soliloquyVideosValidationError),this.button.model.set("text",wp.media.view.l10n.insertIntoPost),this.button.model.set("disabled",!1),!1)}})}(jQuery,window,document,soliloquy_metabox);var SoliloquyBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("soliloquy-meta-bulk-editor-slides"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),SoliloquyBulkEditView=wp.Backbone.View.extend({id:"soliloquy-meta-edit-bulk",tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("soliloquy-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.soliloquy-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,
this.child_views=e.child_views,this.model=new SoliloquySlide},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var t=new SoliloquyBulkEditImageView({model:e});this.$el.find("ul.attachments").append(t.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},100),wpLink.init,this},renderError:function(e){var t={};t.error=e;var i=new wp.media.view.SoliloquyError({model:t});return i.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(){this.trigger("loading");var e=[];this.collection.forEach(function(t){e.push(t.id)},this),wp.media.ajax("soliloquy_bulk_save_meta",{context:this,data:{nonce:soliloquy_metabox.save_nonce,post_id:soliloquy_metabox.id,meta:this.model.attributes,image_ids:e},success:function(e){this.collection.forEach(function(e){for(var t in this.model.attributes)value=this.model.attributes[t],value.length>0&&e.set(t,value);var i=JSON.stringify(e.attributes);jQuery("ul#soliloquy li#"+e.get("id")).attr("data-solioquy-image-model",i),jQuery("ul#soliloquy li#"+e.get("id")+" div.title").text(e.get("title"))},this),this.trigger("loaded loaded:success"),SoliloquyModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function($){$("#soliloquy-settings-content").on("click","a.soliloquy-slides-edit",function(e){e.preventDefault(),SoliloquySlidesUpdate(!0),SoliloquyModalWindow.content(new SoliloquyBulkEditView({collection:SoliloquySlides,child_views:SoliloquyChildViews})),SoliloquyModalWindow.open()})}),jQuery(document).ready(function($){$("a.soliloquy-media-library").on("click",function(e){return e.preventDefault(),wp.media.frames.soliloquy?void wp.media.frames.soliloquy.open():(wp.media.frames.soliloquy=new wp.media.view.MediaFrame.Post({title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0,library:{type:"image"}}),wp.media.frames.soliloquy.on("open",function(){var e=wp.media.frames.soliloquy.state().get("selection");$("ul#soliloquy-output li").each(function(){var t=wp.media.attachment($(this).attr("id"));e.add(t?[t]:[])})}),wp.media.frames.soliloquy.on("ready",function(e){}),wp.media.frames.soliloquy.on("insert",function(e){var t=wp.media.frames.soliloquy.state(),i=[];e.each(function(e){var o=t.display(e).toJSON(),l=e.get("type");switch(o.link){case"none":e.set("link","");break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",o.linkUrl)}"image"===l&&i.push(e.toJSON())},this),$.post(soliloquy_metabox.ajax,{action:"soliloquy_insert_slides",nonce:soliloquy_metabox.insert_nonce,post_id:soliloquy_metabox.id,images:JSON.stringify(i)},function(e){e&&($("#soliloquy-output").html(e.data),SoliloquySlidesUpdate(),$(document).trigger("insertSlides"))},"json")}),wp.media.frames.soliloquy.open(),$("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),$("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"),void $("div.media-menu a.media-menu-item:nth-child(6)").addClass("hidden"))})}),function($,e,t){"use strict";var i=e.location.hash,o=e.location.hash.replace("!","");if(i&&i.indexOf("soliloquy-tab")>=0){var l=$(o.replace("tab_","")),s=l.parent(),a=l.parent().parent().find("ul.soliloquy-tabs-nav"),n=$("#post").attr("action");s.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),l.addClass("soliloquy-tab-active"),a.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),a.find('a[href="'+o.replace("tab_","")+'"]').parent().addClass("soliloquy-tab-nav-active"),n&&(n=n.split("#")[0],$("#post").attr("action",n+e.location.hash)),$("body").trigger("SoliloquyTabChange")}$(function(){$("[data-soliloquy-tab]").on("click",function(t){t.preventDefault();var i=$(this),o=i.attr("data-tab-id"),l=i.parent(),s=l.parent(),a=l.attr("data-update-hashbang"),n="undefined"!=typeof i.attr("href")?"tab_"+i.attr("href"):"tab_"+o;if(!i.hasClass("soliloquy-tab-nav-active")){if(s.find(".soliloquy-tab-active").removeClass("soliloquy-tab-active"),l.find(".soliloquy-tab-nav-active").removeClass("soliloquy-tab-nav-active"),i.addClass("soliloquy-tab-nav-active"),$("#"+o).addClass("soliloquy-tab-active"),i.trigger("SoliloquyTabChange"),"soliloquy-native"===o&&$("#soliloquy-type-default").prop("checked")!==!0&&($("#soliloquy-types-nav li").removeClass("soliloquy-active"),$("#soliloquy-type-default").prop("checked",!0).trigger("change")),"1"===a){e.location.hash=n.split("#").join("#!");var d=$("#post").attr("action");d&&(d=d.split("#")[0],$("#post").attr("action",d+e.location.hash))}return!1}})})}(jQuery,window,document);