!function(a,b){as3cfpro.Sidebar={pollInterval:0,busy:{},tools:{},setTools:function(a){this.tools=a},updateTools:function(b){a.each(this.tools,function(c,d){a.each(d,function(a){null!=b[a]&&(as3cfpro.Sidebar.tools[c][a]=b[a])})}),this.refreshButtonStates()},updateTool:function(b,c){a.each(this.tools,function(a,d){for(var e in d)if(e===b)return as3cfpro.Sidebar.tools[a][b]=c,!1}),this.refreshButtonStates()},getTool:function(a,b){return null==this.tools[a][b]?{}:this.tools[a][b]},setToolAsProcessing:function(a){this.updateTool(a,{is_processing:!0})},setToolAsIdle:function(a){this.updateTool(a,{is_processing:!1})},startPollInterval:function(){this.pollInterval=setInterval(this.getStatus,5e3)},refreshButtonStates:function(){this.tools.length<=0||a.each(this.tools,function(b,c){var d=[];a.each(c,function(a,b){(b.is_processing||b.is_queued)&&d.push(a)}),d.length>0?as3cfpro.Sidebar.lockTab(b):as3cfpro.Sidebar.unlockTab(b)})},lockTab:function(b){a('.as3cf-sidebar [data-tab="'+b+'"]').find("a.start").addClass("disabled")},unlockTab:function(b){a('.as3cf-sidebar [data-tab="'+b+'"]').find("a.start").removeClass("disabled")},isTabLocked:function(a){if(null!=this.tools[a])for(var b in this.tools[a])if(this.tools[a][b].is_processing||this.tools[a][b].is_queued)return!0;return!1},getStatus:function(){a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{nonce:as3cfpro.nonces.get_status,action:"as3cfpro_get_status"},success:function(a){as3cfpro.Sidebar.updateSidebar(a),as3cfpro.Sidebar.updateTools(a),as3cfpro.Sidebar.updateNotices(a)}})},updateSidebar:function(a){b.isEmpty(a)||b.each(a,as3cfpro.Sidebar.updateSidebarBlock)},updateSidebarBlock:function(b,c){if(!as3cfpro.Sidebar.isToolBusy(c)){var d=a(".as3cf-sidebar.pro").find("#"+c),e=d.find(".progress-bar");a(e).animate({width:b.progress+"%"},1200),as3cfpro.Sidebar.updateBlockStatusDescription(d,b.description),as3cfpro.Sidebar.updateBlockProgressContainer(d,b),as3cfpro.Sidebar.updateBlockButtons(d,b),(b.is_paused||b.is_cancelled)&&b.is_processing||d.find(".button").removeClass("disabled");var f=a(".nav-tab-wrapper").find(".nav-tab-active").data("tab"),g=d.data("tab");b.should_render?d.data("render",1):d.data("render",0),b.should_render&&f===g?d.show():d.hide(),d.trigger("status-change",[b,c])}},isToolBusy:function(a){return!(null==this.busy[a]||!this.busy[a])},updateBlockStatusDescription:function(a,b){var c=a.find(".block-description");null!=b&&b.length>0?c.html(b).show():c.hide()},updateBlockProgressBar:function(a,b){a.find(".progress-bar").css("width",b+"%")},updateBlockProgressContainer:function(a,b){var c=a.find(".progress-bar-wrapper"),d=b.description;b.is_queued&&!b.is_cancelled&&"undefined"!=typeof b.progress&&"undefined"!=typeof b.queue&&"undefined"!=typeof b.queue.total&&"undefined"!=typeof b.queue.processed&&b.queue.total>0&&(d=b.progress+"% ("+b.queue.processed+" / "+b.queue.total+")"),c.attr("title",d),b.is_paused&&!b.is_processing?c.addClass("paused"):c.removeClass("paused"),b.is_queued?c.show():c.hide()},updateBlockButtons:function(a,b){var c=a.find(".button-wrapper"),d=c.find(".pause"),e=c.find(".resume");b.is_queued?(c.addClass("processing"),b.is_paused?(d.hide(),e.show()):(d.show(),e.hide())):(c.removeClass("processing"),d.hide(),e.hide())},handleManualAction:function(b){if(b.preventDefault(),!a(b.target).hasClass("disabled")){var c=a(b.target),d=as3cfpro.Sidebar.getToolOverride(c);if(0===d.length){var e=c.closest(".block");d=e.attr("id");var f=as3cfpro.Sidebar.getBusyText(c);as3cfpro.Sidebar.busy[d]=!0,e.find(".button").addClass("disabled");var g={is_queued:!0,is_paused:!1,is_processing:!0};as3cfpro.Sidebar.updateBlockProgressContainer(e,g),as3cfpro.Sidebar.updateBlockButtons(e,g),f&&as3cfpro.Sidebar.updateBlockStatusDescription(e,f)}"start"===b.data.action&&as3cfpro.Sidebar.setToolAsProcessing(d),a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:{nonce:as3cfpro.nonces.tools[d][b.data.action],action:"as3cfpro_"+d+"_"+b.data.action},complete:function(){setTimeout(function(){as3cfpro.Sidebar.busy[d]=!1},1e3)}})}},getBusyText:function(a){var b=a.data("busy-description");return null!=b&&b.length?b:""},getToolOverride:function(a){var b=a.data("tool-override");return null!=b&&b.length?b:""},renderPieChart:function(){var b,c=a(".as3cf-sidebar.pro .pie-chart"),d=c.closest(".block-scope"),e=d.find(".block-title"),f=d.data("state"),g=function(a){return f.states[a]||f.states[1]},h=function(a){var b=f.i18n["title_"+g(a)]||f.i18n.title_partial_complete;e.text(b.replace("%s%",a))},i=function(a,b,d){c.attr("title",a+"% ("+b+" / "+d+")")},j=function(a){var b=f.i18n["upload_"+g(a)]||f.i18n.upload_partial_complete;d.find(".as3cf-pro-tool.button").text(b)};f&&(b=new as3cfpro.Sidebar.PieChart(c),b.render(c.data("percentage")),a(".as3cf-sidebar.pro").on("status-change",function(a,e,g){g===f.slug&&c.length&&"undefined"!=typeof e.total_progress&&(c.attr("data-percentage",e.total_progress),h(e.total_progress),i(e.total_progress,e.total_on_provider,e.total_items),j(e.total_progress),b.render(e.total_progress),d.toggleClass("completed",100===e.total_progress))}))},PieChart:function(a){this.$el=a,this.radius=100,this.value=0,this.render=function(a){var b=3.6*a,c=[this.radius*Math.cos(Math.PI*b/180),this.radius*Math.sin(Math.PI*b/180)];this.$el.find("svg path").attr("d","M0,0 L"+this.radius+",0 A"+this.radius+","+this.radius+" 0 1,1 "+c[0]+","+c[1]+" Z"),this.value=a}},updateNotices:function(a){b.isEmpty(a)||b.each(a,as3cfpro.Sidebar.updateToolNotices)},updateToolNotices:function(a,b){"undefined"!=typeof a.notices&&!1!==a.notices&&as3cfpro.tool.renderErrorNotices(b,a.notices)}},a(document).ready(function(){as3cfpro.Sidebar.setTools(as3cfSidebarTools),as3cfpro.Sidebar.startPollInterval(),as3cfpro.Sidebar.refreshButtonStates(),as3cfpro.Sidebar.renderPieChart(),a(".as3cf-sidebar").on("click",".background-tool .start",{action:"start"},as3cfpro.Sidebar.handleManualAction),a(".as3cf-sidebar").on("click",".background-tool .button.cancel",{action:"cancel"},as3cfpro.Sidebar.handleManualAction),a(".as3cf-sidebar").on("click",".background-tool .button.pause-resume",{action:"pause_resume"},as3cfpro.Sidebar.handleManualAction)})}(jQuery,_);