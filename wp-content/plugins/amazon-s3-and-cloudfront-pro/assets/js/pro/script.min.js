!function(a,b,c){function d(b){var c=e(b),d=!1,f=as3cfpro.settings.previous_url_whitelist;return a.each(c,function(b,c){return-1!==a.inArray(b,f)&&c!==n[b]?(d=!0,!1):void 0}),d}function e(b){var c=a(b).serializeArray(),d={};return a.each(c,function(a,b){d[b.name]=b.value}),d}function f(b){if("support"!==b&&a(".as3cf-pro-check-again").length){var c=a(".as3cf-pro-check-again").attr("href");as3cf.tabs.defaultTab===b&&(b=""),""!==b&&(b="#"+b);var d=c.indexOf("#");0===d&&(d=c.length),c=c.substr(0,d)+b,a(".as3cf-pro-check-again").attr("href",c)}}function g(b){a(".support-content").hasClass("checking-licence")||(a(".support-content").addClass("checking-licence"),a(".support-content p:first").append('<img src="'+as3cfpro.spinnerUrl+'" alt="" class="check-license-ajax-spinner general-spinner" />'),a(".as3cf-pro-license-notice").remove(),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_check_licence",licence:b,nonce:as3cfpro.nonces.check_licence},error:function(b,c,d){alert(as3cfpro.strings.license_check_problem),a(".support-content").removeClass("checking-licence")},success:function(b){if("undefined"!=typeof b.dbrains_api_down)a(".support-content").empty().html(b.dbrains_api_down+b.message);else if("undefined"!=typeof b.errors){var c="";for(var d in b.errors)c+=b.errors[d];a(".support-content").empty().html(c)}else a(".support-content").empty().html(b.message);"undefined"!=typeof b.pro_error&&0===a(".as3cf-pro-license-notice").length&&a("h2.nav-tab-wrapper").after(b.pro_error),a(".support-content").removeClass("checking-licence")}}))}function h(){a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_render_sidebar_tools",nonce:as3cfpro.nonces.render_sidebar_tools},success:function(b){if(!0===b.success&&"undefined"!=typeof b.data){a(".as3cf-sidebar.pro").empty(),a(".as3cf-sidebar.pro").prepend(b.data);var c=j();i(c),a(".as3cf-sidebar.pro .block .progress-bar-wrapper .progress-bar").each(function(){a(this).animate({width:a(this).parent().data("percentage")+"%"},1200)})}}})}function i(b){b=""===b?as3cf.tabs.defaultTab:b,a(".as3cf-sidebar.pro .block").not("."+b).hide(),a(".as3cf-sidebar.pro .block."+b).show()}function j(){var a="";return window.location.hash&&(a=window.location.hash.substring(1)),a=as3cf.tabs.sanitizeHash(a)}var k=ajaxurl.replace("/admin-ajax.php",""),l=k+"/images/spinner",m=!1,n=null;window.devicePixelRatio>=2&&(l+="-2x"),l+=".gif",as3cfpro.spinnerUrl=l;var o=as3cf.tabs.toggle;as3cf.tabs.toggle=function(b){o(b),"support"===b?"1"===as3cfpro.strings.has_licence?g():a(".licence-input").focus():f(b),i(b)};var p=as3cf.buckets.set;as3cf.buckets.set=function(b,d,e){var f=a("#"+c.prefix+"-active-bucket").text();p(b,d,e),"as3cf"===c.prefix&&""===f.trim()&&h()},a(document).ready(function(){function b(b,c){a(".licence-input, .register-licence").remove(),a(".licence-not-entered").prepend(b.masked_licence),a(".support-content").empty().html("<p>"+as3cfpro.strings.fetching_license+"</p>"),h(),g(c)}var k=j();f(k),i(k);var l=a("#tab-"+as3cf.tabs.defaultTab+" .as3cf-main-settings form");n=e(l),a("body").on("click","#tab-"+as3cf.tabs.defaultTab+' .as3cf-main-settings button[type="submit"]',function(a){d(l)&&c.exists(".as3cf-find-replace-container")&&(a.preventDefault(),as3cfFindAndReplaceSettings.open(l))}),a(".enter-licence").click(function(b){b.preventDefault(),as3cf.tabs.toggle("support"),window.location.hash="support",a(".licence-input").focus()}),a(".licence-form").submit(function(c){if(c.preventDefault(),!m){a(".licence-status").removeClass("notification-message error-notice success-notice");var d=a.trim(a(".licence-input").val());if(""===d)return a(".licence-status").addClass("notification-message error-notice"),void a(".licence-status").html(as3cfpro.strings.enter_license_key);a(".as3cf-pro-license-notice").remove(),a(".licence-status").empty().removeClass("success"),m=!0,a(".button.register-licence").attr("disabled",!0),a(".button.register-licence").after('<img src="'+as3cfpro.spinnerUrl+'" alt="" class="register-licence-ajax-spinner general-spinner" />'),a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",cache:!1,data:{action:"as3cfpro_activate_licence",licence_key:d,nonce:as3cfpro.nonces.activate_licence},error:function(b,c,d){m=!1,a(".register-licence-ajax-spinner").remove(),a(".licence-status").html(as3cfpro.strings.register_license_problem),a(".button.register-licence").attr("disabled",!1)},success:function(c){if(m=!1,a(".button.register-licence").attr("disabled",!1),a(".register-licence-ajax-spinner").remove(),"undefined"!=typeof c.errors){var e="";for(var f in c.errors)e+=c.errors[f];a(".licence-status").html(e),"undefined"!=typeof c.masked_licence&&b(c,d)}else"undefined"!=typeof c.wpmdb_error&&"undefined"!=typeof c.body?a(".licence-status").html(c.body):(a(".licence-status").html(as3cfpro.strings.license_registered).delay(5e3).fadeOut(1e3),a(".licence-status").addClass("success notification-message success-notice"),b(c,d),a(".invalid-licence").hide());"undefined"!=typeof c.pro_error&&0===a(".as3cf-pro-license-notice").length&&a("h2.nav-tab-wrapper").after(c.pro_error)}})}}),a("body").on("click",".reactivate-licence",function(b){b.preventDefault();var c=a("<div/>",{id:"processing-licence"}).html(as3cfpro.strings.attempting_to_activate_licence);c.append('<img src="'+as3cfpro.spinnerUrl+'" alt="" class="check-license-ajax-spinner general-spinner" />'),a(".invalid-licence").hide().after(c),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_reactivate_licence",nonce:as3cfpro.nonces.reactivate_licence},error:function(b,d,e){c.remove(),a(".invalid-licence").show().html(as3cfpro.strings.activate_licence_problem),a(".invalid-licence").append("<br /><br />"+as3cfpro.strings.status+": "+b.status+" "+b.statusText+"<br /><br />"+as3cfpro.strings.response+"<br />"+b.responseText)},success:function(b){return c.remove(),"undefined"!=typeof b.as3cfpro_error&&1===b.as3cfpro_error?void a(".invalid-licence").html(b.body).show():"undefined"!=typeof b.dbrains_api_down&&1===b.dbrains_api_down?(a(".invalid-licence").html(as3cfpro.strings.temporarily_activated_licence),void a(".invalid-licence").append(b.body).show()):(a(".invalid-licence").empty().html(as3cfpro.strings.licence_reactivated),a(".invalid-licence").addClass("success notification-message success-notice").show(),void location.reload())}})}),a("body").on("click",".support-tab-link",function(a){as3cf.tabs.toggle("support")})})}(jQuery,_,as3cfModal);