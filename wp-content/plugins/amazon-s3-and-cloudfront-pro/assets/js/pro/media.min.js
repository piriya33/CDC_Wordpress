!function(a,b){var c=wp.media;c.view.OffloadButton=c.view.Button.extend({defaults:{text:"",style:"primary",size:"large",disabled:!1},initialize:function(a){a&&(this.options=a,this.defaults.text=as3cfpro_media.strings[this.options.action]),this.options=b.extend({},this.defaults,this.options),c.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this)},render:function(){return c.view.Button.prototype.render.apply(this,arguments),this.toggleDisabled(),this},toggleDisabled:function(){var a=this.controller.state().get("selection").length>0;a?this.$el.removeClass("disabled"):this.$el.addClass("disabled")},click:function(a){a.preventDefault();var c=this.controller.state().get("selection"),d=c.models;if(!this.$el.hasClass("disabled")&&c.length){var e={_ajax_nonce:as3cfpro_media.nonces[this.options.scope+"_"+this.options.action],scope:this.options.scope,s3_action:this.options.action,ids:b.pluck(d,"id")};this.startOffloadAction(),this.fireOffloadAction(e).done(function(){b.each(d,function(a){a.fetch()})})}},startOffloadAction:function(){a(".media-toolbar .spinner").css("visibility","visible").show(),a(".media-toolbar-secondary .button").addClass("disabled"),a(".offload-buttons__submenu").addClass("hidden")},fireOffloadAction:function(a){return wp.ajax.send("as3cfpro_process_media_action",{data:a}).done(b.bind(this.returnOffloadAction,this))},returnOffloadAction:function(b){b&&""!==b&&(a(".as3cf-notice").remove(),a("#wp-media-grid h1").after(b)),this.controller.trigger("selection:action:done"),a(".media-toolbar .spinner").attr("style","").hide()}}),c.view.OffloadToggle=c.view.Button.extend({className:"offload-buttons__toggle",defaults:{style:"primary",size:"large",priority:-80,disabled:!0},initialize:function(){return c.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this),a("body").on("click",this.blur),this},click:function(a){if(a.preventDefault(),!this.$el.hasClass("disabled")){var b=this.controller.content.get().toolbar;this.$el.toggleClass("opened"),b.$(".offload-buttons__submenu").toggleClass("hidden")}},blur:function(){var b=a(".media-toolbar .offload-buttons__toggle"),c=a(".media-toolbar .offload-buttons__submenu");b.hasClass("opened")&&!c.parent().is(":active, :hover")&&(c.addClass("hidden"),b.removeClass("opened"))},toggleDisabled:function(){var a=this.controller.state().get("selection").length>0;this.model.set("disabled",!a),a?this.$el.removeClass("disabled"):this.$el.addClass("disabled")}});var d=c.view.SelectModeToggleButton;c.view.SelectModeToggleButton=d.extend({toggleBulkEditHandler:function(){d.prototype.toggleBulkEditHandler.call(this,arguments);var a=this.controller.content.get().toolbar,b=a.$(".offload-buttons"),c=b.find(".offload-buttons__submenu");this.controller.isModeActive("select")?b.addClass("visible"):b.removeClass("visible"),c.length&&b.width(c.outerWidth())}});var e=c.view.AttachmentsBrowser;c.view.AttachmentsBrowser=e.extend({createToolbar:function(){e.prototype.createToolbar.call(this);var a=as3cfpro_media.actions.bulk.shift(),d=new c.view.OffloadButton({action:a,classes:"offload-buttons__action-default",scope:"bulk",controller:this.controller}).render();if(as3cfpro_media.actions.bulk.length){var f=[];b(as3cfpro_media.actions.bulk).each(function(a){f.push(new c.view.OffloadButton({action:a,classes:"offload-buttons__action",scope:"bulk",controller:this.controller}).render())}.bind(this));var g=new c.view.OffloadToggle({controller:this.controller}).render(),h=new c.view.ButtonGroup({buttons:f,classes:"offload-buttons__submenu hidden"}).render();this.toolbar.set("OffloadButtons",new c.view.ButtonGroup({buttons:[d,h,g],classes:"offload-buttons",priority:-80}).render())}else this.toolbar.set("OffloadButtons",new c.view.OffloadButton({action:a,scope:"bulk",classes:"offload-buttons",priority:-80,controller:this.controller}).render())}})}(jQuery,_);