!function(a,b){var c=wp.media;c.view.s3Button=c.view.Button.extend({defaults:{text:"",style:"primary",size:"large",disabled:!1},initialize:function(a){a&&(this.options=a,this.defaults.text=as3cfpro_media.strings[this.options.action]),this.options=b.extend({},this.defaults,this.options),c.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this)},toggleDisabled:function(){this.model.set("disabled",!this.controller.state().get("selection").length)},click:function(a){if(a.preventDefault(),!this.$el.hasClass("disabled")){var c=this.controller.state().get("selection");if(c.length){var d=!1,e=this,f=[];if(c.each(function(a){f.push(a),!d&&e.options.confirm&&a.attributes[e.options.confirm]&&(d=!0)}),!this.options.confirm||!d||confirm(as3cfpro_media.strings[this.options.confirm])){var g=as3cfpro_media.nonces[this.options.action+"_media"],h={_nonce:g,s3_action:this.options.action,ids:b.pluck(f,"id")};this.startS3Action(),this.fireS3Action(h).done(function(){b.each(f,function(a){a.fetch()})})}}}},startS3Action:function(){a(".media-toolbar .spinner").css("visibility","visible").show(),a(".media-toolbar-secondary .button").addClass("disabled")},fireS3Action:function(a){return wp.ajax.send("as3cfpro_process_media_action",{data:a}).done(b.bind(this.returnS3Action,this))},returnS3Action:function(b){b&&""!==b&&(a(".as3cf-notice").remove(),a("#wp-media-grid h2").after(b)),this.controller.trigger("selection:action:done"),a(".media-toolbar .spinner").hide(),a(".media-toolbar-secondary .button").removeClass("disabled")},render:function(){return c.view.Button.prototype.render.apply(this,arguments),this.controller.isModeActive("select")?this.$el.addClass("s3-actions-selected-button"):this.$el.addClass("s3-actions-selected-button hidden"),this.toggleDisabled(),this}});var d=c.view.SelectModeToggleButton;c.view.SelectModeToggleButton=d.extend({toggleBulkEditHandler:function(){d.prototype.toggleBulkEditHandler.call(this,arguments);var a=this.controller.content.get().toolbar;this.controller.isModeActive("select")?a.$(".s3-actions-selected-button").removeClass("hidden"):a.$(".s3-actions-selected-button").addClass("hidden")}});var e=c.view.AttachmentsBrowser;c.view.AttachmentsBrowser=e.extend({createToolbar:function(){e.prototype.createToolbar.call(this),this.toolbar.set("copyS3SelectedButton",new c.view.s3Button({action:"copy",controller:this.controller,priority:-60}).render()),this.toolbar.set("removeS3SelectedButton",new c.view.s3Button({action:"remove",controller:this.controller,priority:-60,confirm:"bulk_local_warning"}).render()),this.toolbar.set("downloadS3SelectedButton",new c.view.s3Button({action:"download",controller:this.controller,priority:-60}).render())}}),a(document).ready(function(){function b(b){var c='<option value="bulk_as3cfpro_'+b+'">'+as3cfpro_media.strings[b]+"</option>";a('select[name^="action"] option:last-child').after(c)}function c(){b("copy"),b("remove"),b("download")}c(),a("body").on("click",".as3cfpro_remove a.local-warning",function(a){return!!confirm(as3cfpro_media.strings.local_warning)||(a.preventDefault(),a.stopImmediatePropagation(),!1)}),a("body").on("click",".bulkactions #doaction",function(b){var c=a("#bulk-action-selector-top").val();if("bulk_as3cfpro_remove"!==c)return!0;var d=!1,e=0;return a('input:checkbox[name="media[]"]:checked').each(function(){var b=a(this).parent().siblings(".column-title");if(b.find(".row-actions span.as3cfpro_remove a").hasClass("local-warning"))return e++,confirm(as3cfpro_media.strings.bulk_local_warning)&&(d=!0),!1}),!(e>0)||d})})}(jQuery,_);