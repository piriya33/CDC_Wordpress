"undefined"==typeof tribe&&(tribe={}),void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.block={num_attendees:0,event:{}},function(t,e){"use strict";e.selector={container:".tribe-block__tickets",submit:".tribe-block__tickets__buy",item:".tribe-block__tickets__item",itemOptOut:".tribe-block__tickets__item__optout",itemQuantity:".tribe-block__tickets__item__quantity",itemQuantityInput:".tribe-ticket-quantity",itemExtraAvailable:".tribe-block__tickets__item__extra__available",itemExtraAvailableQuantity:".tribe-block__tickets__item__extra__available_quantity"},0!==t(e.selector.container).length&&(t(e.selector.item).on("click",".tribe-block__tickets__item__quantity__remove, .tribe-block__tickets__item__quantity__add",function(e){e.preventDefault();var i=t(this).parent().find('input[type="number"]'),a=t(this).hasClass("tribe-block__tickets__item__quantity__add"),c=i[0].step?Number(i[0].step):1,s=Number(i[0].value);if(a){var l=i[0].max?Number(i[0].max):-1;if("function"==typeof i[0].stepUp)try{i[0].stepUp()}catch(t){i[0].value=-1===l||l>=s+c?s+c:l}else i[0].value=-1===l||l>=s+c?s+c:l}else{var r=i[0].min?Number(i[0].min):0;if("function"==typeof i[0].stepDown)try{i[0].stepDown()}catch(t){i[0].value=r<=s-c?s-c:r}else i[0].value=r<=s-c?s-c:r}s!==i[0].value&&i.trigger("change")}),t(e.selector.item).on("change",".tribe-ticket-quantity",function(i){var a=t(this),c=a.closest(e.selector.item),s=c.data("ticket-id"),l=a.closest(e.selector.container),r=parseInt(a.val(),10);r=isNaN(r)?0:r,c.has(e.selector.itemOptOut).length&&(r>0?t(e.selector.itemOptOut).show():t(e.selector.itemOptOut).hide()),"Tribe__Tickets__Commerce__PayPal__Main"===l.data("provider")&&(r>0?l.find('[data-ticket-id]:not([data-ticket-id="'+s+'"])').closest("div.tribe-block__tickets__item").find("input, button").attr("disabled","disabled").closest("div").addClass("tribe-tickets-purchase-disabled"):l.find("input, button").removeAttr("disabled").closest("div").removeClass("tribe-tickets-purchase-disabled"))}),e.getTickets=function(){return t(e.selector.item).map(function(){return t(this).data("ticket-id")}).get()},e.updateAvailability=function(i){Object.keys(i).forEach(function(a){var c=i[a].available,s=t(e.selector.item+"[data-ticket-id='"+a+"']");if(0===c){var l=i[a].unavailable_html;s.attr("available",!1),s.removeClass("instock"),s.removeClass("purchasable"),s.find(e.selector.itemExtraAvailable).replaceWith(l),s.find(e.selector.itemQuantity).html(l)}1<c&&(s.find(e.selector.itemQuantityInput).attr({max:c}),s.find(e.selector.itemExtraAvailableQuantity).html(c))})},e.checkAvailability=function(){var i={action:"ticket_availability_check",tickets:e.getTickets()};t.post(TribeTickets.ajaxurl,i,function(t){if(t.success){var i=t.data.tickets;e.updateAvailability(i)}}),setTimeout(e.checkAvailability,15e3)},e.init=function(){e.checkAvailability()},e.init())}(jQuery,tribe.tickets.block);