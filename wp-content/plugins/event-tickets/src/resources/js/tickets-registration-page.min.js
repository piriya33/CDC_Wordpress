"undefined"==typeof tribe&&(tribe={}),void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.registration={},function(e,t){"use strict";t.hasChanges={},t.formClasses={woo:"tribe-block__tickets__item__attendee__fields__form--woo",edd:"tribe-block__tickets__item__attendee__fields__form--edd"},t.selector={container:".tribe-block__tickets__registration__event",fields:".tribe-block__tickets__item__attendee__fields",fieldsError:".tribe-block__tickets__item__attendee__fields__error",fieldsErrorRequired:".tribe-block__tickets__item__attendee__fields__error--required",fieldsErrorAjax:".tribe-block__tickets__item__attendee__fields__error--ajax",fieldsSuccess:".tribe-block__tickets__item__attendee__fields__success",loader:".tribe-block__tickets__item__attendee__fields__loader",form:".tribe-block__tickets__item__attendee__fields__form",toggler:".tribe-block__tickets__registration__toggle__handler",status:".tribe-block__tickets__registration__status",field:{text:".tribe-block__tickets__item__attendee__field__text",checkbox:".tribe-block__tickets__item__attendee__field__checkbox",select:".tribe-block__tickets__item__attendee__field__select",radio:".tribe-block__tickets__item__attendee__field__radio"},checkout:".tribe-block__tickets__registration__checkout",checkoutButton:".tribe-block__tickets__registration__checkout__submit"},0!==e(t.selector.container).length&&(e(t.selector.container).on("click",t.selector.toggler,function(i){i.preventDefault();var s=e(this);s.closest(t.selector.container).find(t.selector.fields).toggle(),s.toggleClass("open")}),t.validateEventAttendees=function(i){var s=!0;return i.find(".tribe-tickets-meta-required").each(function(){var i=e(this);0===(i.is(t.selector.field.radio)||i.is(t.selector.field.checkbox)?i.find("input:checked").length?"checked":"":i.is(t.selector.field.select)?i.find("select").val():i.find("input, textarea").val().trim()).length&&(s=!1)}),s},t.updateStatusToComplete=function(e){e.find(t.selector.status).removeClass("incomplete"),e.find(t.selector.status).find("i").removeClass("dashicons-edit"),e.find(t.selector.status).find("i").addClass("dashicons-yes")},t.updateStatusToIncomplete=function(e){e.find(t.selector.status).addClass("incomplete"),e.find(t.selector.status).find("i").addClass("dashicons-edit"),e.find(t.selector.status).find("i").removeClass("dashicons-yes")},t.handleTppSaveSubmission=function(i){var s=e(this),o=s.closest(t.selector.fields);o.find(t.selector.fieldsErrorRequired).hide(),t.validateEventAttendees(s)||(i.preventDefault(),o.find(t.selector.fieldsErrorRequired).show())},t.handleSaveSubmission=function(i){i.preventDefault();var s=e(this),o=s.closest(t.selector.fields),n=o.closest(t.selector.container);if(o.find(t.selector.fieldsErrorRequired).hide(),o.find(t.selector.fieldsErrorAjax).hide(),o.find(t.selector.fieldsSuccess).hide(),t.validateEventAttendees(s)){o.find(t.selector.loader).show();var r="",c="";"object"==typeof TribeTicketsPlus&&(r=TribeTicketsPlus.ajaxurl,c=TribeTicketsPlus.save_attendee_info_nonce);var a=n.data("event-id"),l=s.serializeArray();l.push({name:"event_id",value:a}),l.push({name:"action",value:"tribe-tickets-save-attendee-info"}),l.push({name:"nonce",value:c}),e.post(r,l,function(i){i.success&&(t.updateStatusToComplete(n),t.hasChanges[a]=!1,o.find(t.selector.fieldsSuccess).show(),i.data.meta_up_to_date&&e(t.selector.checkoutButton).removeAttr("disabled"))}).fail(function(){o.find(t.selector.fieldsErrorAjax).show()}).always(function(){o.find(t.selector.loader).hide()})}else o.find(t.selector.fieldsErrorRequired).show(),t.updateStatusToIncomplete(n)},t.handleCheckoutSubmission=function(e){!Object.keys(t.hasChanges).reduce(function(e,i){return e||t.hasChanges[i]},!1)||confirm(tribe_l10n_datatables.registration_prompt)||e.preventDefault()},t.setHasChanges=function(e){return function(){t.hasChanges[e]=!0}},t.bindFormFields=function(e){var i=e.data("event-id");t.hasChanges[i]=!1,[e.find(t.selector.field.text),e.find(t.selector.field.checkbox),e.find(t.selector.field.radio),e.find(t.selector.field.select)].forEach(function(e){(e.is(t.selector.field.radio)||e.is(t.selector.field.checkbox)?e.find("input"):e.is(t.selector.field.select)?e.find("select"):e.find("input, textarea")).change(t.setHasChanges(i))})},t.bindCheckout=function(){e(t.selector.checkout).submit(t.handleCheckoutSubmission)},t.bindEvents=function(){t.bindCheckout()},t.initContainers=function(){e(t.selector.container).each(function(){var i=e(this);t.validateEventAttendees(i)?t.updateStatusToComplete(i):t.updateStatusToIncomplete(i);var s=i.find(t.selector.form);s.hasClass(t.formClasses.woo)||s.hasClass(t.formClasses.edd)?e(s).on("submit",t.handleSaveSubmission):e(s).on("submit",t.handleTppSaveSubmission),t.bindFormFields(i)})},t.initPage=function(){t.initContainers(),t.bindEvents()},t.init=function(){t.initPage()},t.init())}(jQuery,tribe.tickets.registration);