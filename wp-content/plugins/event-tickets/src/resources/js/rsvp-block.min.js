var tribe_tickets_rsvp_block={events:{}};!function(t,e){"use strict";e.tribe_rsvp_toggle_actions=function(t){var e=t.hasClass("tribe-block__rsvp__status-button--going")?".tribe-block__rsvp__status-button--not-going":".tribe-block__rsvp__status-button--going",i=t.closest(".tribe-block__rsvp__status").find(e);t.addClass("tribe-active"),t.attr("disabled","disabled"),i.removeClass("tribe-active"),i.removeAttr("disabled")},e.events.handle_rsvp_response=function(){var i=t(this),s=i.closest(".tribe-block__rsvp__ticket"),r=s.data("rsvp-id"),_=i.hasClass("tribe-block__rsvp__status-button--going");e.tribe_rsvp_toggle_actions(i);var n={action:"rsvp-form",ticket_id:r,going:_?"yes":"no"};e.tribe_rsvp_loader_start(s),t.post(TribeRsvp.ajaxurl,n,function(t){var i=s.find(".tribe-block__rsvp__form");if(i.html(t.data.html),window.tribe_event_tickets_plus){var r=i.find("input.tribe-tickets-quantity");window.tribe_event_tickets_plus.meta.block_set_quantity(r,_)}e.tribe_rsvp_loader_end(s)})},e.events.handle_quantity_change=function(e){e.preventDefault();var i=t(this).parent().find('input[type="number"]'),s=t(this).hasClass("tribe-block__rsvp__number-input-button--plus"),r=i[0].step?Number(i[0].step):1,_=Number(i[0].value);if(s){var n=i[0].max?Number(i[0].max):-1;if("function"==typeof i[0].stepUp)try{i[0].stepUp()}catch(t){i[0].value=-1===n||n>=_+r?_+r:n}else i[0].value=-1===n||n>=_+r?_+r:n}else{var a=i[0].min?Number(i[0].min):0;if("function"==typeof i[0].stepDown)try{i[0].stepDown()}catch(t){i[0].value=a<=_-r?_-r:a}else i[0].value=a<=_-r?_-r:a}_!==i[0].value&&i.trigger("change")},e.tribe_rsvp_loader_start=function(t){t.find(".tribe-block__rsvp__loading").show()},e.tribe_rsvp_loader_end=function(t){t.find(".tribe-block__rsvp__loading").hide()},e.validate_submission=function(e){var i=e.find("input.tribe-tickets-quantity"),s=e.find("input.tribe-tickets-full-name"),r=e.find("input.tribe-tickets-email");return t.trim(s.val()).length&&t.trim(r.val()).length&&parseFloat(i.val())>0},e.events.handle_submission=function(i){i.preventDefault();var s=t(this).closest(".tribe-block__rsvp__ticket"),r=s.data("rsvp-id"),_=s.find("form"),n=e.validate_submission(_),a=!0,o=!!window.tribe_event_tickets_plus;if(o&&(a=window.tribe_event_tickets_plus.meta.validate_meta(_)),n&&a){var l=_.serializeArray();l.push({name:"action",value:"rsvp-process"}),l.push({name:"ticket_id",value:r}),e.tribe_rsvp_loader_start(s),t.post(TribeRsvp.ajaxurl,l,function(t){var i=t.data.remaining;s.find(".tribe-block__rsvp__details .tribe-block__rsvp__availability").replaceWith(t.data.remaining_html),s.find(".tribe-block__rsvp__form").html(t.data.html),0===i&&s.find(".tribe-block__rsvp__status").replaceWith(t.data.status_html),e.tribe_rsvp_loader_end(s)})}else n?_.find(".tribe-block__rsvp__message__error").hide():_.find(".tribe-block__rsvp__message__error").show(),o&&a?_.find(".tribe-event-tickets-meta-required-message").hide():_.find(".tribe-event-tickets-meta-required-message").show(),t("html, body").animate({scrollTop:_.offset().top-100},300)},e.bind_events=function(){t(".tribe-block__rsvp__ticket").on("click",".tribe-block__rsvp__status-button--going, .tribe-block__rsvp__status-button--not-going",e.events.handle_rsvp_response).on("click",'button[type="submit"]',e.events.handle_submission).on("click",".tribe-block__rsvp__number-input-button--minus, .tribe-block__rsvp__number-input-button--plus",e.events.handle_quantity_change)},e.init=function(){t(".tribe-block__rsvp").length&&e.bind_events()},e.init()}(jQuery,tribe_tickets_rsvp_block);